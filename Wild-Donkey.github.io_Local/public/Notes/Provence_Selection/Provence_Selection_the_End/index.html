<!DOCTYPE HTML>
<html>

<head>
	<link rel="bookmark"  type="image/x-icon"  href="/img/logo_miccall.png"/>
	<link rel="shortcut icon" href="/img/logo_miccall.png">
	
			    <title>
    Wild_Donkey
    </title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="/css/mic_main.css" />
    <link rel="stylesheet" href="/css/dropdownMenu.css" />
    <meta name="keywords" content="Wild_Donkey" />
    
    	<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	 
    <noscript>
        <link rel="stylesheet" href="/css/noscript.css" />
    </noscript>
    <style type="text/css">
        body:before {
          content: ' ';
          position: fixed;
          top: 0;
          background: url('/img/bg.jpg') center 0 no-repeat;
          right: 0;
          bottom: 0;
          left: 0;
          background-size: cover; 
        }
    </style>

			    
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script async type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery.scrollex.min.js"></script>
    <script src="/js/jquery.scrolly.min.js"></script>
    <script src="/js/skel.min.js"></script>
    <script src="/js/util.js"></script>
    <script src="/js/main.js"></script>
	
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.2.0"></head>
    
		<!-- Layouts -->



              <!--  代码渲染  -->
              <link rel="stylesheet" href="/css/prism_coy.css" />
              <link rel="stylesheet" href="/css/typo.css" />
              <!-- 文章页 -->

              <body class>
                <!-- Wrapper 外包 s-->
                <div id="wrapper" class="fade-in">
                  <!-- Intro 头部显示 s -->
                  <!-- Intro 头部显示 e -->
                  <!-- Header 头部logo start -->
                  <header id="header">
    <a href="/" class="logo">Think Different</a>
</header>
                    <!-- Nav 导航条 start -->
                    <nav id="nav" class="special" >
            <ul class="menu links" >
			<!-- Homepage  主页  --> 
			<li >
	            <a href="/" rel="nofollow">Home</a>
	        </li>
			<!-- categories_name  分类   --> 
	        
	        <li class="active">
	            <a href="#s1">Categories</a>
	                    <ul class="submenu">
	                        <li>
	                        <a class="category-link" href="/categories/Contests/">Contests</a></li><li><a class="category-link" href="/categories/Engineering/">Engineering</a></li><li><a class="category-link" href="/categories/Essays/">Essays</a></li><li><a class="category-link" href="/categories/Mathematics/">Mathematics</a></li><li><a class="category-link" href="/categories/Notes/">Notes</a>
	                    </ul>
	        </li>
	        
	        <!-- archives  归档   --> 
	        
	        <li class="active">
	            <a href="#s1">Archives</a>
	                    <ul class="submenu">
	                        <li>
	                        <a class="archive-link" href="/archives/2022/08/">August 2022</a></li><li><a class="archive-link" href="/archives/2022/07/">July 2022</a></li><li><a class="archive-link" href="/archives/2022/06/">June 2022</a></li><li><a class="archive-link" href="/archives/2022/05/">May 2022</a></li><li><a class="archive-link" href="/archives/2022/04/">April 2022</a></li><li><a class="archive-link" href="/archives/2022/03/">March 2022</a></li><li><a class="archive-link" href="/archives/2022/02/">February 2022</a></li><li><a class="archive-link" href="/archives/2022/01/">January 2022</a></li><li><a class="archive-link" href="/archives/2021/11/">November 2021</a></li><li><a class="archive-link" href="/archives/2021/10/">October 2021</a></li><li><a class="archive-link" href="/archives/2021/08/">August 2021</a></li><li><a class="archive-link" href="/archives/2020/11/">November 2020</a>
	                    </ul>
	        </li>
	        
	        
		        <!-- Pages 自定义   -->
		        
		        <li>
		            <a href="/about/" title="About">
		                About
		            </a>
		        </li>
		        
		        <li>
		            <a href="/group/" title="Friends">
		                Friends
		            </a>
		        </li>
		        
		        <li>
		            <a href="/gallery/" title="Gallery">
		                Gallery
		            </a>
		        </li>
		        
		        <li>
		            <a href="/tag/" title="Tags">
		                Tags
		            </a>
		        </li>
		        


            </ul>
            <!-- icons 图标   -->
			<ul class="icons">
                    
                    <li>
                        <a title="github" href="https://github.com/Wild-Donkey" target="_blank" rel="noopener">
                            <i class="icon fa fa-github"></i>
                        </a>
                    </li>
                    
			</ul>
</nav>

                      <div id="main">
                        <div class="post_page_title_img"
                          style="height: 25rem;background-image: url(https://wild-donkey-gallery.oss-cn-hangzhou.aliyuncs.com/BlogImg/GTA7.png);background-position: center; background-repeat:no-repeat; background-size:cover;-moz-background-size:cover;overflow:hidden;">
                          <a href="#" style="padding: 4rem 4rem 2rem 4rem ;">
                            <h2>
                              省选日记 终章
                            </h2>
                          </a>
                        </div>
                        <!-- Post -->
                        <div class="typo" style="padding: 3rem;">
                          <h1 id="省选日记-终章-sdoi2022-游记"><a class="markdownIt-Anchor" href="#省选日记-终章-sdoi2022-游记"></a> 省选日记-终章 (SDOI2022 游记)</h1>
<p>SDOI 重出江湖后被推迟到了 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>5</mn></mrow><annotation encoding="application/x-tex">5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">5</span></span></span></span> 月 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>15</mn></mrow><annotation encoding="application/x-tex">15</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">5</span></span></span></span> 日, 一天考完 Day1 和 Day2. 推迟了 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>41</mn></mrow><annotation encoding="application/x-tex">41</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">4</span><span class="mord">1</span></span></span></span> 天, 是时候有个交代了.</p>
<h2 id="day-41-may-14-2022-saturday"><a class="markdownIt-Anchor" href="#day-41-may-14-2022-saturday"></a> Day <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>41</mn></mrow><annotation encoding="application/x-tex">41</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">4</span><span class="mord">1</span></span></span></span> May 14, 2022, Saturday</h2>
<p>明天省选, 今天继续打板子.</p>
<h3 id="p5055-可持久化文艺平衡树"><a class="markdownIt-Anchor" href="#p5055-可持久化文艺平衡树"></a> <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P5055">P5055 可持久化文艺平衡树</a></h3>
<p>发现可持久化文艺平衡树没写, 意识到自己可持久化平衡树都是 WBLT, 自带两倍点数, 加上自己的代码使用了指针, 自带两倍空间, 所以空间是一般平衡树的四倍, 十分有可能被卡空. 不过可持久化之后点数的差距就没有那么明显了, 所以仍然是 WBLT.</p>
<p>这里看到一个 WBLT 的合并方式明显要比我之前的东周平衡树先进. 如果合并到两棵树的大小相差不超过阈值, 那么直接合并为一个父亲的两个儿子, 否则分类讨论, 如果将较小的树和较大的树的对应儿子合并后, 新树的大小相差不超过阈值, 那么就合并之, 否则先旋转再合并.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="type">long</span> OV, <span class="built_in">Ans</span>(<span class="number">0</span>);</span><br><span class="line"><span class="type">unsigned</span> m, n, A, B, C, D;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">  Node* LS, *RS;</span><br><span class="line">  <span class="type">long</span> <span class="type">long</span> Val;</span><br><span class="line">  <span class="type">unsigned</span> Size;</span><br><span class="line">  <span class="type">char</span> Flip;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Prt</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Udt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Size = (LS ? LS-&gt;Size : <span class="number">0</span>) + (RS ? RS-&gt;Size : <span class="number">0</span>);</span><br><span class="line">    Val = (LS ? LS-&gt;Val : <span class="number">0</span>) + (RS ? RS-&gt;Val : <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">PsDw</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> Node *<span class="title">Rotate</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> Node *<span class="title">Insert</span><span class="params">(<span class="type">unsigned</span> x)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> Node *<span class="title">Delete</span><span class="params">(<span class="type">unsigned</span> x)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> Node *<span class="title">Merge</span><span class="params">(Node* x)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Split</span><span class="params">(Node*&amp; x, Node*&amp; y, <span class="type">unsigned</span> z)</span></span>; </span><br><span class="line">&#125;N[<span class="number">40000005</span>], *Ver[<span class="number">200005</span>], *<span class="built_in">CntN</span>(N);</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Node::Prt</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Node%u: Size %u Val %lld Flg %u LS %u(%u) RS %u(%u)\n&quot;</span>, <span class="keyword">this</span> - N, Size, Val, Flip, LS - N, LS ? LS-&gt;Size : <span class="number">0</span>, RS - N, RS ? RS-&gt;Size : <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Node::PsDw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(Flip) <span class="built_in">swap</span>(LS, RS);</span><br><span class="line">  <span class="keyword">if</span>(LS) *(++CntN) = *LS, LS = CntN, LS-&gt;Flip ^= Flip;</span><br><span class="line">  <span class="keyword">if</span>(RS) *(++CntN) = *RS, RS = CntN, RS-&gt;Flip ^= Flip;</span><br><span class="line">  Flip = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Node *<span class="title">Node::Rotate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(!LS) <span class="keyword">return</span> RS;</span><br><span class="line">  <span class="keyword">if</span>(!RS) <span class="keyword">return</span> LS;</span><br><span class="line">  <span class="keyword">if</span>(Size &lt;= <span class="number">5</span>) <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">if</span>((LS-&gt;Size &lt;&lt; <span class="number">1</span>) &lt; RS-&gt;Size) &#123;</span><br><span class="line">    <span class="function">Node* <span class="title">Cur</span><span class="params">(RS)</span></span>;</span><br><span class="line">    Cur-&gt;<span class="built_in">PsDw</span>(), RS = Cur-&gt;RS, Cur-&gt;RS = Cur-&gt;LS;</span><br><span class="line">    Cur-&gt;LS = LS, LS = Cur, Cur-&gt;<span class="built_in">Udt</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>((RS-&gt;Size &lt;&lt; <span class="number">1</span>) &lt; LS-&gt;Size) &#123;</span><br><span class="line">    <span class="function">Node* <span class="title">Cur</span><span class="params">(LS)</span></span>;</span><br><span class="line">    Cur-&gt;<span class="built_in">PsDw</span>(), LS = Cur-&gt;LS, Cur-&gt;LS = Cur-&gt;RS;</span><br><span class="line">    Cur-&gt;RS = RS, RS = Cur, Cur-&gt;<span class="built_in">Udt</span>(); </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Node *<span class="title">Node::Insert</span><span class="params">(<span class="type">unsigned</span> x)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(Size == <span class="number">1</span>) &#123;</span><br><span class="line">    *(LS = ++CntN) = &#123;<span class="literal">NULL</span>, <span class="literal">NULL</span>, x ? Val : OV, <span class="number">1</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    *(RS = ++CntN) = &#123;<span class="literal">NULL</span>, <span class="literal">NULL</span>, x ? OV : Val, <span class="number">1</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    Flip = <span class="number">0</span>, Val = Val + OV, Size = <span class="number">2</span>; </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">PsDw</span>();</span><br><span class="line">  <span class="keyword">if</span>(x &lt;= LS-&gt;Size) LS = LS-&gt;<span class="built_in">Insert</span>(x);</span><br><span class="line">  <span class="keyword">else</span> RS = RS-&gt;<span class="built_in">Insert</span>(x - LS-&gt;Size);</span><br><span class="line">  <span class="built_in">Udt</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Rotate</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Node *<span class="title">Node::Delete</span><span class="params">(<span class="type">unsigned</span> x)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(Size == <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">  <span class="built_in">PsDw</span>();</span><br><span class="line">  <span class="keyword">if</span>(x &lt;= LS-&gt;Size) LS = LS-&gt;<span class="built_in">Delete</span>(x);</span><br><span class="line">  <span class="keyword">else</span> RS = RS-&gt;<span class="built_in">Delete</span>(x - LS-&gt;Size);</span><br><span class="line">  <span class="built_in">Udt</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Rotate</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Node *<span class="title">Node::Merge</span><span class="params">(Node* x)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(Size + x-&gt;Size &lt;= <span class="number">5</span>) &#123;</span><br><span class="line">    *(++CntN) = &#123;<span class="keyword">this</span>, x, Val + x-&gt;Val, Size + x-&gt;Size, <span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">return</span> CntN;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(Size &gt; (x-&gt;Size &lt;&lt; <span class="number">1</span>)) &#123;<span class="built_in">PsDw</span>(), RS = RS-&gt;<span class="built_in">Merge</span>(x), <span class="built_in">Udt</span>(); <span class="keyword">return</span> <span class="keyword">this</span>;&#125;</span><br><span class="line">  <span class="keyword">if</span>(x-&gt;Size &gt; (Size &lt;&lt; <span class="number">1</span>)) &#123;x-&gt;<span class="built_in">PsDw</span>(), x-&gt;LS = <span class="built_in">Merge</span>(x-&gt;LS), x-&gt;<span class="built_in">Udt</span>(); <span class="keyword">return</span> x;&#125;</span><br><span class="line">  *(++CntN) = &#123;<span class="keyword">this</span>, x, Val + x-&gt;Val, Size + x-&gt;Size, <span class="number">0</span>&#125;;</span><br><span class="line">  <span class="keyword">return</span> CntN;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Node::Split</span><span class="params">(Node*&amp; x, Node*&amp; y, <span class="type">unsigned</span> z)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">PsDw</span>();</span><br><span class="line">  <span class="keyword">if</span>(LS-&gt;Size == z) &#123;x = LS, y = RS;<span class="keyword">return</span>;&#125;</span><br><span class="line">  Node *Cur;</span><br><span class="line">  <span class="keyword">if</span>(LS-&gt;Size &gt; z) LS-&gt;<span class="built_in">Split</span>(x, Cur, z), y = Cur-&gt;<span class="built_in">Merge</span>(RS);</span><br><span class="line">  <span class="keyword">else</span> RS-&gt;<span class="built_in">Split</span>(Cur, y, z - LS-&gt;Size), x = LS-&gt;<span class="built_in">Merge</span>(Cur);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  n = <span class="built_in">RD</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt;= n; ++i) &#123;</span><br><span class="line">    A = <span class="built_in">RD</span>(), B = <span class="built_in">RD</span>(), C = <span class="built_in">RD</span>() ^ Ans;</span><br><span class="line">    <span class="keyword">switch</span>(B) &#123;</span><br><span class="line">      <span class="built_in">case</span> (<span class="number">1</span>) :&#123;</span><br><span class="line">        OV = <span class="built_in">RD</span>() ^ Ans;</span><br><span class="line">        <span class="keyword">if</span>(!Ver[A]) *(Ver[i] = ++CntN) = &#123;<span class="literal">NULL</span>, <span class="literal">NULL</span>, OV, <span class="number">1</span>, <span class="number">0</span>&#125;;</span><br><span class="line">        <span class="keyword">else</span> *(Ver[i] = ++CntN) = *Ver[A], Ver[i]-&gt;<span class="built_in">Insert</span>(C);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">case</span> (<span class="number">2</span>) :&#123;</span><br><span class="line">        *(Ver[i] = ++CntN) = *Ver[A], Ver[i]-&gt;<span class="built_in">Delete</span>(C);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">default</span> :&#123;</span><br><span class="line">        D = <span class="built_in">RD</span>() ^ Ans;</span><br><span class="line">        Node* Part1, *Part2, *Part3;</span><br><span class="line">        *(Ver[i] = ++CntN) = *Ver[A];</span><br><span class="line">        <span class="keyword">if</span>(C &gt; <span class="number">1</span>) Ver[i]-&gt;<span class="built_in">Split</span>(Part1, Part2, C - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">else</span> Part2 = Ver[i], Part1 = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">if</span>(D ^ Ver[i]-&gt;Size) Part2-&gt;<span class="built_in">Split</span>(Part2, Part3, D - C + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">else</span> Part3 = <span class="literal">NULL</span>;</span><br><span class="line"><span class="comment">//        printf(&quot;Done\n&quot;); </span></span><br><span class="line">        <span class="keyword">if</span>(B &amp; <span class="number">1</span>) Part2-&gt;Flip ^= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, Ans = Part2-&gt;Val);</span><br><span class="line">        <span class="keyword">if</span>(Part3) Part2 = Part2-&gt;<span class="built_in">Merge</span>(Part3);</span><br><span class="line">        <span class="keyword">if</span>(Part1) Ver[i] = Part1-&gt;<span class="built_in">Merge</span>(Part2);</span><br><span class="line">        <span class="keyword">else</span> Ver[i] = Part2;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> Wild_Donkey;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ctsc2012-熟悉的文章"><a class="markdownIt-Anchor" href="#ctsc2012-熟悉的文章"></a> <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4022">CTSC2012 熟悉的文章</a></h3>
<p>当时补正睿的时候做到过这道题, 但是因为太难跳过了, 今天当成 SAM 的板子打一下.</p>
<p>一开始想出 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><msup><mo><mi>log</mi><mo>⁡</mo></mo><mn>2</mn></msup><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n\log^2 n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.148448em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8984479999999999em;"><span style="top:-3.1473400000000002em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span> 的时候还疑惑为什么这个题可以用 ACAM 做. 后来发现 ACAM 只能识别前缀, 不能识别子串. 所以还是得建 GSAM. 接下来是真正的 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><msup><mo><mi>log</mi><mo>⁡</mo></mo><mn>2</mn></msup><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n\log^2 n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.148448em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8984479999999999em;"><span style="top:-3.1473400000000002em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span> 做法.</p>
<p>可以对模式串建立 GSAM, 然后对询问串的每一个前缀得到一个和所有模式串的 LCS (最长公共后缀). 记 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 为第 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> 个前缀和所有模式串的 LCS. 接下来二分 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">L</span></span></span></span>, 用 DP 验证可行性.</p>
<p>我们把所有串反过来, 那么统计的 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">a</span></span></span></span> 就成了 LCP 序列, 设计状态 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">f_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 表示前缀 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> 的分割最少有多少没有被划分为熟悉子串的字符. 那么可以写出方程:</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mtable rowspacing="0.24999999999999992em" columnalign="right left right" columnspacing="0em 1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msub><mi>f</mi><mrow><mi>i</mi><mo>+</mo><mi>j</mi></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>min</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>f</mi><mrow><mi>i</mi><mo>+</mo><mi>j</mi></mrow></msub><mo separator="true">,</mo><msub><mi>f</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo fence="true">(</mo><mi>j</mi><mo>∈</mo><mo stretchy="false">[</mo><mi>L</mi><mo separator="true">,</mo><msub><mi>a</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy="false">]</mo><mo fence="true">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msub><mi>f</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>min</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>f</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>f</mi><mi>i</mi></msub><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
f_{i + j} &amp;= \min (f_{i + j}, f_i) &amp;\left(j \in [L, a_{i + 1}]\right)\\
f_{i + 1} &amp;= \min (f_{i + 1}, f_i + 1)
\end{aligned}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.0000000000000004em;vertical-align:-1.2500000000000002em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.7500000000000002em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">+</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2500000000000002em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.7500000000000002em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mop">min</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">+</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mop">min</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2500000000000002em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-r"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.7500000000000002em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mopen">[</span><span class="mord mathdefault">L</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>初始是 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mi>i</mi></msub><mo>=</mo><mi>i</mi></mrow><annotation encoding="application/x-tex">f_i = i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span>, 可以用线段树优化转移, 单次判断 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span>.</p>
<p>算上二分 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">L</span></span></span></span>, 总复杂度 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><msup><mo><mi>log</mi><mo>⁡</mo></mo><mn>2</mn></msup><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n\log^2n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.148448em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8984479999999999em;"><span style="top:-3.1473400000000002em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span>.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> a[<span class="number">1100005</span>];</span><br><span class="line"><span class="type">unsigned</span> m, n, Len;</span><br><span class="line"><span class="type">unsigned</span> A, B, C, D, t;</span><br><span class="line"><span class="function"><span class="type">unsigned</span> <span class="title">Cnt</span><span class="params">(<span class="number">0</span>)</span>, <span class="title">Ans</span><span class="params">(<span class="number">0</span>)</span>, Match</span>;</span><br><span class="line"><span class="type">char</span> SPool[<span class="number">1100005</span>], *<span class="built_in">S</span>(SPool);</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Seg</span> &#123;</span><br><span class="line">  Seg* LS, *RS;</span><br><span class="line">  <span class="type">unsigned</span> Tag;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">PsDw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    LS-&gt;Tag = <span class="built_in">min</span>(LS-&gt;Tag, Tag);</span><br><span class="line">    RS-&gt;Tag = <span class="built_in">min</span>(RS-&gt;Tag, Tag);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Build</span><span class="params">(<span class="type">unsigned</span> L, <span class="type">unsigned</span> R)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Edit</span> <span class="params">(<span class="type">unsigned</span> L, <span class="type">unsigned</span> R)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(A &lt;= L &amp;&amp; R &lt;= B) &#123;Tag = <span class="built_in">min</span>(Tag, C); <span class="keyword">return</span>;&#125;</span><br><span class="line">    <span class="built_in">PsDw</span>();</span><br><span class="line">    <span class="function"><span class="type">unsigned</span> <span class="title">Mid</span><span class="params">((L + R) &gt;&gt; <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">if</span>(A &lt;= Mid) LS-&gt;<span class="built_in">Edit</span>(L, Mid);</span><br><span class="line">    <span class="keyword">if</span>(B &gt; Mid) RS-&gt;<span class="built_in">Edit</span>(Mid + <span class="number">1</span>, R);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Find</span> <span class="params">(<span class="type">unsigned</span> L, <span class="type">unsigned</span> R)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(L == R) &#123;B = Tag; <span class="keyword">return</span>;&#125;</span><br><span class="line">    <span class="built_in">PsDw</span>();</span><br><span class="line">    <span class="function"><span class="type">unsigned</span> <span class="title">Mid</span><span class="params">((L + R) &gt;&gt; <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">if</span>(A &lt;= Mid) LS-&gt;<span class="built_in">Find</span>(L, Mid);</span><br><span class="line">    <span class="keyword">else</span> RS-&gt;<span class="built_in">Find</span>(Mid + <span class="number">1</span>, R);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;Se[<span class="number">2200005</span>], *<span class="built_in">CntS</span>(Se);</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Seg::Build</span><span class="params">(<span class="type">unsigned</span> L, <span class="type">unsigned</span> R)</span> </span>&#123;</span><br><span class="line">  Tag = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line">  <span class="keyword">if</span>(L == R) &#123; LS = RS = <span class="literal">NULL</span>; <span class="keyword">return</span>; &#125;</span><br><span class="line">  <span class="function"><span class="type">unsigned</span> <span class="title">Mid</span><span class="params">((L + R) &gt;&gt; <span class="number">1</span>)</span></span>;</span><br><span class="line">  (LS = ++CntS)-&gt;<span class="built_in">Build</span>(L, Mid);</span><br><span class="line">  (RS = ++CntS)-&gt;<span class="built_in">Build</span>(Mid + <span class="number">1</span>, R);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">char</span> <span class="title">Judge</span> <span class="params">(<span class="type">unsigned</span> x)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(!x) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  (CntS = Se)-&gt;<span class="built_in">Build</span>(<span class="number">1</span>, Len);</span><br><span class="line">  <span class="function"><span class="type">unsigned</span> <span class="title">Cur</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">0</span>); i &lt; Len; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span>(a[i + <span class="number">1</span>] &gt;= x)</span><br><span class="line">      A = i + x, B = i + a[i + <span class="number">1</span>], C = Cur, Se-&gt;<span class="built_in">Edit</span>(<span class="number">1</span>, Len);</span><br><span class="line">    A = i + <span class="number">1</span>, Se-&gt;<span class="built_in">Find</span>(<span class="number">1</span>, Len), Cur = <span class="built_in">min</span>(Cur + <span class="number">1</span>, B);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> Cur &lt;= (Len * <span class="number">0.1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Solve</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="type">unsigned</span> <span class="title">L</span><span class="params">(<span class="number">0</span>)</span>, <span class="title">R</span><span class="params">(Len)</span>, Mid</span>;</span><br><span class="line">  <span class="keyword">while</span> (L ^ R) &#123;</span><br><span class="line">    Mid = ((L + R + <span class="number">1</span>) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">Judge</span>(Mid)) L = Mid;</span><br><span class="line">    <span class="keyword">else</span> R = Mid - <span class="number">1</span>; </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%u\n&quot;</span>, L);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&#123;</span><br><span class="line">  Node *E[<span class="number">2</span>], *Fail;</span><br><span class="line">  <span class="type">unsigned</span> Len;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Prt</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> Node*<span class="title">Find</span><span class="params">(<span class="type">char</span> c)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> Node*<span class="title">Add</span><span class="params">(<span class="type">char</span> c)</span></span>;</span><br><span class="line">&#125;N[<span class="number">2200005</span>], *<span class="built_in">CntN</span>(N);</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Node::Prt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Node%u: Sons %u %u Fail %u Len %u\n&quot;</span>, <span class="keyword">this</span> - N, E[<span class="number">0</span>] - N, E[<span class="number">1</span>] - N, Fail - N, Len);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Node* <span class="title">Node::Find</span><span class="params">(<span class="type">char</span> c)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(E[c]) &#123;++Match; <span class="keyword">return</span> E[c];&#125;</span><br><span class="line">  <span class="function">Node* <span class="title">Back</span><span class="params">(Fail)</span></span>;</span><br><span class="line">  <span class="keyword">while</span> (Back &amp;&amp; (!Back-&gt;E[c])) Back = Back-&gt;Fail;</span><br><span class="line">  Match = Back ? (Back-&gt;Len + <span class="number">1</span>) : <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> Back ? Back-&gt;E[c] : N;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Node* <span class="title">Node::Add</span><span class="params">(<span class="type">char</span> c)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(E[c]) &#123;</span><br><span class="line">    <span class="keyword">if</span>(E[c]-&gt;Len == Len + <span class="number">1</span>) <span class="keyword">return</span> E[c];</span><br><span class="line">    <span class="function">Node* <span class="title">Copy</span><span class="params">(++CntN)</span>, *<span class="title">Back</span><span class="params">(<span class="keyword">this</span>)</span>, *<span class="title">Ori</span><span class="params">(E[c])</span></span>;</span><br><span class="line">    *Copy = *E[c], Copy-&gt;Len = Len + <span class="number">1</span>, Ori-&gt;Fail = Copy;</span><br><span class="line">    <span class="keyword">while</span> (Back &amp;&amp; (Back-&gt;E[c] == Ori)) Back-&gt;E[c] = Copy, Back = Back-&gt;Fail;</span><br><span class="line">    <span class="keyword">return</span> Copy;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function">Node*<span class="title">Cur</span><span class="params">(++CntN)</span>, *<span class="title">Back</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">  Cur-&gt;Len = Len + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (Back &amp;&amp; (!Back-&gt;E[c])) Back-&gt;E[c] = Cur, Back = Back-&gt;Fail;</span><br><span class="line">  <span class="keyword">if</span>(!Back) &#123;Cur-&gt;Fail = N; <span class="keyword">return</span> Cur;&#125;</span><br><span class="line">  <span class="keyword">if</span>(Back-&gt;E[c]-&gt;Len == Back-&gt;Len + <span class="number">1</span>) &#123;Cur-&gt;Fail = Back-&gt;E[c]; <span class="keyword">return</span> Cur;&#125;</span><br><span class="line">  <span class="function">Node*<span class="title">Copy</span><span class="params">(++CntN)</span>, *<span class="title">Ori</span><span class="params">(Back-&gt;E[c])</span></span>;</span><br><span class="line">  *Copy = *Ori, Copy-&gt;Len = Back-&gt;Len + <span class="number">1</span>;</span><br><span class="line">  Cur-&gt;Fail = Ori-&gt;Fail = Copy;</span><br><span class="line">  <span class="keyword">while</span> (Back &amp;&amp; (Back-&gt;E[c] == Ori)) Back-&gt;E[c] = Copy, Back = Back-&gt;Fail;</span><br><span class="line">  <span class="keyword">return</span> Cur;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  n = <span class="built_in">RD</span>(), m = <span class="built_in">RD</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt;= m; ++i) &#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, S), Len = <span class="built_in">strlen</span>(S);</span><br><span class="line">    <span class="function">Node* <span class="title">Cur</span><span class="params">(N)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">j</span>(<span class="number">0</span>); j &lt; Len; ++j) Cur = Cur-&gt;<span class="built_in">Add</span>(S[j] - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    S = S + Len;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt;= n; ++i) &#123;</span><br><span class="line">    <span class="function">Node* <span class="title">Cur</span><span class="params">(N)</span></span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, S), Len = <span class="built_in">strlen</span>(S), Match = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">j</span>(<span class="number">0</span>); j &lt; Len; ++j)</span><br><span class="line">      Cur = Cur-&gt;<span class="built_in">Find</span>(S[j] - <span class="string">&#x27;0&#x27;</span>), a[Len - j] = Match;</span><br><span class="line">    S = S + Len;</span><br><span class="line">    <span class="built_in">Solve</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> Wild_Donkey;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>写完以后小调之后过了样例, 提交有了 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>8</mn><msup><mn>0</mn><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">80&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord">8</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>, 喜出望外这次的 GSAM 一次写对了, 但是复杂度上的缺陷确实过不了 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1.1</mn><mi>e</mi><mn>6</mn></mrow><annotation encoding="application/x-tex">1.1e6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">.</span><span class="mord">1</span><span class="mord mathdefault">e</span><span class="mord">6</span></span></span></span>, 开了 <code>-O2</code> 拿到了 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>9</mn><msup><mn>0</mn><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">90&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord">9</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>.</p>
<p>正难则反, 发现不用把 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">a</span></span></span></span> 反过来表示 LCP, 设 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 仍然表示询问串第 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> 个前缀和模式串的 LCS, 设计状态 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">f_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 表示第 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> 个前缀缀最少的没有被标记为熟悉的子串的长度总和, 则有这样的方程:</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mi>i</mi></msub><mo>=</mo><mi>min</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>f</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><mn>1</mn><mo separator="true">,</mo><munderover><mo><mi>min</mi><mo>⁡</mo></mo><mrow><mi>j</mi><mo>=</mo><mi>L</mi></mrow><msub><mi>a</mi><mi>i</mi></msub></munderover><msub><mi>f</mi><mrow><mi>i</mi><mo>−</mo><mi>j</mi></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f_i = \min(f_{i - 1} + 1, \min_{j = L}^{a_i} f_{i - j})
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">min</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.160791em;vertical-align:-0.880439em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2803520000000002em;"><span style="top:-2.0556690000000004em;margin-left:0em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mathdefault mtight">L</span></span></span></span><span style="top:-2.7em;"><span class="pstrut" style="height:2.7em;"></span><span><span class="mop">min</span></span></span><span style="top:-3.57896em;margin-left:0em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.880439em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p>
<p>发现这个方程可以用单调队列优化. (虽然这个时候提到单调队列有点搞心态)</p>
<p>对于 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mi>a</mi></msub><mo>≤</mo><msub><mi>f</mi><mi>b</mi></msub></mrow><annotation encoding="application/x-tex">f_a \leq f_b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi><mo>−</mo><mi>L</mi><mo>≥</mo><mi>a</mi><mo>&gt;</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">i - L \geq a &gt; b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8193em;vertical-align:-0.13597em;"></span><span class="mord mathdefault">L</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathdefault">a</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mi>b</mi></msub></mrow><annotation encoding="application/x-tex">f_b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 在转移中是无用的, 因此我们维护一个单调队列, 每次转移进行一次二分查找, 并且插入一个元素. 这样仍然是 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><msup><mo><mi>log</mi><mo>⁡</mo></mo><mn>2</mn></msup><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n\log^2 n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.148448em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8984479999999999em;"><span style="top:-3.1473400000000002em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span>, 但是常数会减少. 所以最慢一个点 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>977</mn><mi>m</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">977ms</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">9</span><span class="mord">7</span><span class="mord">7</span><span class="mord mathdefault">m</span><span class="mord mathdefault">s</span></span></span></span> 险过.</p>
<p>所以啊, 年轻人会二分查找是真的好.</p>
<blockquote>
<p>Stop learning useless algorithms, go and solve some problems, learn how to use binary search.   ----Um_nik</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> a[<span class="number">1100005</span>], f[<span class="number">1100005</span>], Stack[<span class="number">1100005</span>], *<span class="built_in">STop</span>(Stack);</span><br><span class="line"><span class="type">char</span> SPool[<span class="number">1100005</span>], *<span class="built_in">S</span>(SPool);</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">char</span> <span class="title">Judge</span> <span class="params">(<span class="type">unsigned</span> x)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(!x) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  <span class="function"><span class="type">unsigned</span> <span class="title">Cur</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">  <span class="built_in">memset</span>(f + <span class="number">1</span>, <span class="number">0x3f</span>, Len &lt;&lt; <span class="number">2</span>);</span><br><span class="line">  f[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt;= Len; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span>(i &gt;= x) &#123;</span><br><span class="line">      <span class="keyword">while</span> ((STop &gt; Stack) &amp;&amp; (f[i - x] &lt;= f[*STop])) --STop;</span><br><span class="line">      *(++STop) = i - x;</span><br><span class="line">    &#125;</span><br><span class="line">    f[i] = f[i - <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(a[i] &gt;= x)</span><br><span class="line">      f[i] = <span class="built_in">min</span>(f[i], f[*<span class="built_in">lower_bound</span>(Stack + <span class="number">1</span>, STop + <span class="number">1</span>, i - a[i])]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> f[Len] &lt;= (Len * <span class="number">0.1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">/*这部分和上一份代码都一样*/</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt;= n; ++i) &#123;</span><br><span class="line">    <span class="function">Node* <span class="title">Cur</span><span class="params">(N)</span></span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, S), Len = <span class="built_in">strlen</span>(S), Match = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">j</span>(<span class="number">0</span>); j &lt; Len; ++j)</span><br><span class="line">      Cur = Cur-&gt;<span class="built_in">Find</span>(S[j] - <span class="string">&#x27;0&#x27;</span>), a[j + <span class="number">1</span>] = Match; <span class="comment">// 只有这个地方把 a[Len - j] 改成了 a[j + 1]</span></span><br><span class="line">    S = S + Len;</span><br><span class="line">    <span class="built_in">Solve</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> Wild_Donkey;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>不过这道题是有单 log 做法的, 只不过 AC 限制了我的思考, 所以去看题解学习一下.</p>
<p>原理其实很简单, 我们求出来的 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">a</span></span></span></span> 数组, 由于是一个字符一个字符匹配的, 每次最多增加 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>, 所以一定有 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><mo>+</mo><mn>1</mn><mo>≥</mo><msub><mi>a</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">a_i + 1 \geq a_{i + 1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.78041em;vertical-align:-0.13597em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span>. DP 中, 可以转移 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">f_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的状态最小是 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi><mo>−</mo><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">i - a_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, 因为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><mo>+</mo><mn>1</mn><mo>≥</mo><msub><mi>a</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">a_i + 1 \geq a_{i + 1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.78041em;vertical-align:-0.13597em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span>, 因此 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi><mo>−</mo><msub><mi>a</mi><mi>i</mi></msub><mo>≤</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo>−</mo><msub><mi>a</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">i - a_i \leq i + 1 - a_{i + 1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.7859700000000001em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span>, 因此左边界单调增加, 所以我们可以直接将队尾弹出, 让单调栈真正变成单调队列, 这样就不用二分查找了, 总复杂度 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span>.</p>
<p>代码其余部分都相同.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> a[<span class="number">1100005</span>], f[<span class="number">1100005</span>], Que[<span class="number">1100005</span>], *Hd, *Tl;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">char</span> <span class="title">Judge</span> <span class="params">(<span class="type">unsigned</span> x)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(!x) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  <span class="function"><span class="type">unsigned</span> <span class="title">Cur</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">  <span class="built_in">memset</span>(f + <span class="number">1</span>, <span class="number">0x3f</span>, Len &lt;&lt; <span class="number">2</span>);</span><br><span class="line">  f[<span class="number">0</span>] = <span class="number">0</span>, Hd = Tl = Que; </span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt;= Len; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span>(i &gt;= x) &#123;</span><br><span class="line">      <span class="keyword">while</span> ((Hd &lt; Tl) &amp;&amp; (f[i - x] &lt;= f[*Tl])) --Tl;</span><br><span class="line">      *(++Tl) = i - x;</span><br><span class="line">    &#125;</span><br><span class="line">    f[i] = f[i - <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> ((Hd &lt; Tl) &amp;&amp; ((*(Hd + <span class="number">1</span>)) &lt; i - a[i])) ++Hd;</span><br><span class="line">    <span class="keyword">if</span>((Hd &lt; Tl) &amp;&amp; (*(Hd + <span class="number">1</span>) &lt;= i - x)) f[i] = <span class="built_in">min</span>(f[i], f[*(Hd + <span class="number">1</span>)]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> f[Len] &lt;= (Len * <span class="number">0.1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="noi2011-阿狸的打字机"><a class="markdownIt-Anchor" href="#noi2011-阿狸的打字机"></a> <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2414">NOI2011 阿狸的打字机</a></h3>
<p>打字机打字的过程其实就是对 Trie 树遍历的过程, 我们可以建一棵 Trie 出来.</p>
<p>如果构造 ACAM, 询问一个字符串在另一个字符串中出现的次数, 就是查询 Fail 树上某个节点的子树中有多少个另一个串也含有的节点.</p>
<p>我们要查询的是 Trie 树上的一条路径上的节点在 Fail 树中的一个子树中出现了多少个, 因此将 Trie 重链剖分, 将问题转化为重链剖分套二维数点.</p>
<p>记一个 DFS 序, 然后在 Fail 树上按 DFS 序建立可持久化权值线段树. 因为是两个共用节点的树形结构, 我们分两个 DFS 序考虑. 设 Trie 树上节点 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> 的 DFS 序为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi><mi>r</mi><mi>i</mi><mi>e</mi><msub><mi>R</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">TrieR_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">e</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, 在 Fail 树上节点 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> DFS 序为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>F</mi><mi>a</mi><mi>i</mi><mi>l</mi><msub><mi>R</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">FailR_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mord mathdefault">a</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>. 这个可持久化权值线段树以 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>F</mi><mi>a</mi><mi>i</mi><mi>l</mi><mi>R</mi></mrow><annotation encoding="application/x-tex">FailR</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mord mathdefault">a</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span></span></span></span> 为版本号, 以 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi><mi>r</mi><mi>i</mi><mi>e</mi><mi>R</mi></mrow><annotation encoding="application/x-tex">TrieR</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span></span></span></span> 为序, 在两个版本上查询就是在一棵 Fail 树的子树上查询, 而区间查询则是查询某个 Tire 树上的链上的节点在这个子树中的数量. 单次查询 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><msup><mo><mi>log</mi><mo>⁡</mo></mo><mn>2</mn></msup><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n\log^2 n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.148448em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8984479999999999em;"><span style="top:-3.1473400000000002em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span>.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> m, <span class="built_in">n</span>(<span class="number">0</span>);</span><br><span class="line"><span class="type">unsigned</span> A, B, C, D, t;</span><br><span class="line"><span class="function"><span class="type">unsigned</span> <span class="title">Cnt</span><span class="params">(<span class="number">0</span>)</span>, <span class="title">Ans</span><span class="params">(<span class="number">0</span>)</span>, <span class="title">Tmp</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line"><span class="type">char</span> a[<span class="number">100005</span>];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Seg</span> &#123;</span><br><span class="line">  Seg *LS, *RS;</span><br><span class="line">  <span class="type">unsigned</span> Val;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Insert</span><span class="params">(Seg* x, <span class="type">unsigned</span> L, <span class="type">unsigned</span> R)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Find</span><span class="params">(Seg* x, <span class="type">unsigned</span> L, <span class="type">unsigned</span> R)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(A &lt;= L &amp;&amp; R &lt;= B) &#123; Ans += Val - (x ? x-&gt;Val : <span class="number">0</span>);<span class="keyword">return</span>; &#125;</span><br><span class="line">    <span class="function"><span class="type">unsigned</span> <span class="title">Mid</span><span class="params">((L + R) &gt;&gt; <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">if</span>(A &lt;= Mid &amp;&amp; LS) LS-&gt;<span class="built_in">Find</span>(x ? x-&gt;LS : <span class="literal">NULL</span>, L, Mid);</span><br><span class="line">    <span class="keyword">if</span>(B &gt; Mid &amp;&amp; RS) RS-&gt;<span class="built_in">Find</span>(x ? x-&gt;RS : <span class="literal">NULL</span>, Mid + <span class="number">1</span>, R);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;S[<span class="number">2000005</span>], *Ver[<span class="number">100005</span>], *<span class="built_in">CntS</span>(S);</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Seg::Insert</span><span class="params">(Seg* x, <span class="type">unsigned</span> L, <span class="type">unsigned</span> R)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(x) *<span class="keyword">this</span> = *x;</span><br><span class="line">  ++Val;</span><br><span class="line">  <span class="keyword">if</span>(L == R) &#123;<span class="keyword">return</span>;&#125;</span><br><span class="line">  <span class="function"><span class="type">unsigned</span> <span class="title">Mid</span><span class="params">((L + R) &gt;&gt; <span class="number">1</span>)</span></span>;</span><br><span class="line">  <span class="keyword">if</span>(A &lt;= Mid) (LS = ++CntS)-&gt;<span class="built_in">Insert</span>(x ? x-&gt;LS : <span class="literal">NULL</span>, L, Mid);</span><br><span class="line">  <span class="keyword">else</span> (RS = ++CntS)-&gt;<span class="built_in">Insert</span>(x ? x-&gt;RS : <span class="literal">NULL</span>, Mid + <span class="number">1</span>, R);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&#123;</span><br><span class="line">  vector&lt;Node*&gt; Son;</span><br><span class="line">  Node *E[<span class="number">26</span>], *Fa, *Fail, *Heavy, *Top;</span><br><span class="line">  <span class="type">unsigned</span> Dep, SizeF, SizeT, FailR, TrieR;</span><br><span class="line">  <span class="type">char</span> My;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">DFST</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    TrieR = ++Cnt;</span><br><span class="line">    <span class="keyword">if</span>(Heavy) Heavy-&gt;Top = Top, Heavy-&gt;<span class="built_in">DFST</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">char</span> <span class="built_in">i</span>(<span class="number">0</span>); i &lt; <span class="number">26</span>; ++i) </span><br><span class="line">      <span class="keyword">if</span>(E[i] &amp;&amp; (E[i] != Heavy)) E[i]-&gt;Top = E[i], E[i]-&gt;<span class="built_in">DFST</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">DFSF</span> <span class="params">()</span></span>;</span><br><span class="line">&#125;N[<span class="number">100005</span>], *List[<span class="number">100005</span>], *Rev[<span class="number">100005</span>], *<span class="built_in">Last</span>(N), *<span class="built_in">CntN</span>(N);</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Node::DFSF</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">  Rev[FailR = ++Cnt] = <span class="keyword">this</span>, SizeF = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> i:Son) i-&gt;<span class="built_in">DFSF</span>(), SizeF += i-&gt;SizeF; </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">BFS</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  Node* Que[CntN - N + <span class="number">3</span>], **<span class="built_in">Hd</span>(Que), **<span class="built_in">Tl</span>(Que);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">char</span> <span class="built_in">i</span>(<span class="number">0</span>); i &lt; <span class="number">26</span>; ++i) <span class="keyword">if</span>(N-&gt;E[i]) *(++Tl) = N-&gt;E[i];</span><br><span class="line">  <span class="keyword">while</span> (Hd &lt; Tl) &#123;</span><br><span class="line">    <span class="function">Node *<span class="title">Cur</span><span class="params">(*(++Hd))</span>, *<span class="title">Back</span><span class="params">(Cur-&gt;Fa-&gt;Fail)</span></span>;</span><br><span class="line">    Cur-&gt;Dep = Cur-&gt;Fa-&gt;Dep + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (Back &amp;&amp; (!(Back-&gt;E[Cur-&gt;My]))) Back = Back-&gt;Fail;</span><br><span class="line">    <span class="keyword">if</span>(Back &amp;&amp; Back-&gt;E[Cur-&gt;My]) Cur-&gt;Fail = Back-&gt;E[Cur-&gt;My];</span><br><span class="line">    <span class="keyword">else</span> Cur-&gt;Fail = N;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">char</span> <span class="built_in">i</span>(<span class="number">0</span>); i &lt; <span class="number">26</span>; ++i) <span class="keyword">if</span>(Cur-&gt;E[i]) *(++Tl) = Cur-&gt;E[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (Node** <span class="built_in">i</span>(Tl); i &gt; Que; --i) &#123;</span><br><span class="line">    (*i)-&gt;SizeT = <span class="number">1</span>;</span><br><span class="line">    <span class="function"><span class="type">unsigned</span> <span class="title">Mx</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">char</span> <span class="built_in">j</span>(<span class="number">0</span>); j &lt; <span class="number">26</span>; ++j) <span class="keyword">if</span>((*i)-&gt;E[j]) &#123;</span><br><span class="line">      (*i)-&gt;SizeT += (*i)-&gt;E[j]-&gt;SizeT;</span><br><span class="line">      <span class="keyword">if</span>(Mx &lt; (*i)-&gt;E[j]-&gt;SizeT)</span><br><span class="line">        Mx = ((*i)-&gt;Heavy = (*i)-&gt;E[j])-&gt;SizeT;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, a + <span class="number">1</span>);</span><br><span class="line">  A = <span class="built_in">strlen</span>(a + <span class="number">1</span>), m = <span class="built_in">RD</span>();</span><br><span class="line">  <span class="keyword">while</span> (A &amp;&amp; (a[A] ^ <span class="string">&#x27;P&#x27;</span>)) --A;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt;= A; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span>(a[i] == <span class="string">&#x27;P&#x27;</span>) &#123;List[++n] = Last; <span class="keyword">continue</span>;&#125;</span><br><span class="line">    <span class="keyword">if</span>(a[i] == <span class="string">&#x27;B&#x27;</span>) &#123;Last = (Last-&gt;Fa ? Last-&gt;Fa : N); <span class="keyword">continue</span>;&#125;</span><br><span class="line">    <span class="keyword">if</span>(!(Last-&gt;E[a[i] -= <span class="string">&#x27;a&#x27;</span>]))</span><br><span class="line">      (Last-&gt;E[a[i]] = ++CntN)-&gt;Fa = Last, (Last = CntN)-&gt;My = a[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">BFS</span>(), N-&gt;<span class="built_in">DFST</span>(), Cnt = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (Node *<span class="built_in">i</span>(N + <span class="number">1</span>); i &lt;= CntN; ++i) i-&gt;Fail-&gt;Son.<span class="built_in">push_back</span>(i);</span><br><span class="line">  N-&gt;Top = N, N-&gt;<span class="built_in">DFSF</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt;= Cnt; ++i)</span><br><span class="line">    A = Rev[i]-&gt;TrieR, (Ver[i] = ++CntS)-&gt;<span class="built_in">Insert</span>(Ver[i - <span class="number">1</span>], <span class="number">1</span>, Cnt);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt;= m; ++i) &#123;</span><br><span class="line">    <span class="function">Node *<span class="title">QrySt</span><span class="params">(List[RD()])</span>, *<span class="title">ModleSt</span><span class="params">(List[RD()])</span></span>;</span><br><span class="line">    <span class="function">Seg *<span class="title">Frm</span><span class="params">(Ver[QrySt-&gt;FailR - <span class="number">1</span>])</span>, *<span class="title">Too</span><span class="params">(Ver[QrySt-&gt;FailR + QrySt-&gt;SizeF - <span class="number">1</span>])</span></span>;</span><br><span class="line">    Ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (ModleSt) &#123;</span><br><span class="line">      A = ModleSt-&gt;Top-&gt;TrieR, B = ModleSt-&gt;TrieR;</span><br><span class="line">      Too-&gt;<span class="built_in">Find</span>(Frm, <span class="number">1</span>, Cnt);</span><br><span class="line">      ModleSt = ModleSt-&gt;Top-&gt;Fa;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%u\n&quot;</span>, Ans);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> Wild_Donkey;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="day-42-may-15-2022-sunday"><a class="markdownIt-Anchor" href="#day-42-may-15-2022-sunday"></a> Day <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>42</mn></mrow><annotation encoding="application/x-tex">42</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">4</span><span class="mord">2</span></span></span></span> May 15, 2022, Sunday</h2>
<p>今天是省选 Day1 + Day2, 因为有一点空虚, 所以我迟了好久才过来写游记.</p>
<p>期望 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>20</mn><mo>+</mo><mn>35</mn><mo>+</mo><mn>25</mn><mo>+</mo><mn>100</mn><mo>+</mo><mn>10</mn><mo>+</mo><mn>0</mn><mo>=</mo><mn>190</mn></mrow><annotation encoding="application/x-tex">20 + 35 + 25 + 100 + 10 + 0 = 190</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">3</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">9</span><span class="mord">0</span></span></span></span>, 实际挂成了 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn><mo>+</mo><mn>35</mn><mo>+</mo><mn>25</mn><mo>+</mo><mn>100</mn><mo>+</mo><mn>2</mn><mo>+</mo><mn>0</mn><mo>=</mo><mn>162</mn></mrow><annotation encoding="application/x-tex">0 + 35 + 25 + 100 + 2 + 0 = 162</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">3</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">6</span><span class="mord">2</span></span></span></span>. 山东 RK <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>24</mn></mrow><annotation encoding="application/x-tex">24</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord">4</span></span></span></span>, 加上 NOIP 成绩 RK <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>23</mn></mrow><annotation encoding="application/x-tex">23</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord">3</span></span></span></span>. 肯定没有 AB 了, 但是 D 是绝对可以买的.</p>
<p>详细内容参见<a href="/Contests/SDOI2022">省选游记</a>.</p>
<h2 id="day-43-52-may-16-25"><a class="markdownIt-Anchor" href="#day-43-52-may-16-25"></a> Day <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>43</mn><mo>−</mo><mn>52</mn></mrow><annotation encoding="application/x-tex">43-52</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">4</span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">5</span><span class="mord">2</span></span></span></span> May 16 - 25</h2>
<p>省选结束后我进入了一段轻松的退休生活. 有多轻松呢? 反正就是很轻松就是了.</p>
<h2 id="day-55-may-28-2022-saturday"><a class="markdownIt-Anchor" href="#day-55-may-28-2022-saturday"></a> Day <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>55</mn></mrow><annotation encoding="application/x-tex">55</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">5</span><span class="mord">5</span></span></span></span> May 28, 2022, Saturday</h2>
<p>考了省选来 APIO 散散心, 具体内容见<a href="/Contests/APIO2022">游记</a>.</p>

                        </div>

                        <!-- Post Comments -->
                        
    <!-- 使用 DISQUS_CLICK -->
<div id="disqus-comment">
    <div id="disqus_thread"></div>

<!-- add animation -->
<style>
	.disqus_click_btn {
            line-height: 30px;
            margin: 0;
            min-width: 50px;
            padding: 0 14px;
            display: inline-block;
            font-family: "Roboto", "Helvetica", "Arial", sans-serif;
            font-size: 14px;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0;
            overflow: hidden;
            will-change: box-shadow;
            transition: box-shadow .2s cubic-bezier(.4, 0, 1, 1), background-color .2s cubic-bezier(.4, 0, .2, 1), color .2s cubic-bezier(.4, 0, .2, 1);
            outline: 0;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
            vertical-align: middle;
            border: 0;
            background: rgba(158, 158, 158, .2);
            box-shadow: 0 2px 2px 0 rgba(0, 0, 0, .14), 0 3px 1px -2px rgba(0, 0, 0, .2), 0 1px 5px 0 rgba(0, 0, 0, .12);
            color: #fff;
            background-color: #7EC0EE;
            text-shadow: 0
        }
</style>
	
<div class="btn_click_load" id="disqus_bt"> 
    <button class="disqus_click_btn">点击查看评论</button>
</div>

<!--
<script type="text/javascript">
$('.btn_click_load').click(function() {
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'Wild-Donkey'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    document.getElementById('disqus_bt').style.display = "none";
});
</script>
-->
<script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'http://wild-donkey.github.io/Notes/Provence_Selection/Provence_Selection_the_End/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'http://wild-donkey.github.io/Notes/Provence_Selection/Provence_Selection_the_End/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
</script>

<script type="text/javascript">
    $('.btn_click_load').click(function() {  //click to load comments
        (function() { // DON'T EDIT BELOW THIS LINE
            var d = document;
            var s = d.createElement('script');
            s.src = '//Wild-Donkey.disqus.com/embed.js';
            s.setAttribute('data-timestamp', + new Date());
            (d.head || d.body).appendChild(s);
        })();
        $('.btn_click_load').css('display','none');
    });
</script>
</div>
<style>
    #disqus-comment{
        background-color: #eee;
        padding: 2pc;
    }
</style>


                      </div>
                      <!-- Copyright 版权 start -->
                              <div id="copyright">
            <ul>
                <li>&copy;Powered By <a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/" style="border-bottom: none;">hexo</a></li>
                <li>Design: <a target="_blank" rel="noopener" href="http://miccall.tech " style="border-bottom: none;">miccall</a></li>
            </ul>
            
                <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
			
        </div>
                </div>
              </body>


              
 	
</html>
