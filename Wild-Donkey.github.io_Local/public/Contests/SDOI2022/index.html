<!DOCTYPE HTML>
<html>

<head>
	<link rel="bookmark"  type="image/x-icon"  href="/img/logo_miccall.png"/>
	<link rel="shortcut icon" href="/img/logo_miccall.png">
	
			    <title>
    Wild_Donkey
    </title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="/css/mic_main.css" />
    <link rel="stylesheet" href="/css/dropdownMenu.css" />
    <meta name="keywords" content="Wild_Donkey" />
    
    	<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	 
    <noscript>
        <link rel="stylesheet" href="/css/noscript.css" />
    </noscript>
    <style type="text/css">
        body:before {
          content: ' ';
          position: fixed;
          top: 0;
          background: url('/img/bg.jpg') center 0 no-repeat;
          right: 0;
          bottom: 0;
          left: 0;
          background-size: cover; 
        }
    </style>

			    
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script async type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery.scrollex.min.js"></script>
    <script src="/js/jquery.scrolly.min.js"></script>
    <script src="/js/skel.min.js"></script>
    <script src="/js/util.js"></script>
    <script src="/js/main.js"></script>
	
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.2.0"></head>
    
		<!-- Layouts -->



              <!--  代码渲染  -->
              <link rel="stylesheet" href="/css/prism_coy.css" />
              <link rel="stylesheet" href="/css/typo.css" />
              <!-- 文章页 -->

              <body class>
                <!-- Wrapper 外包 s-->
                <div id="wrapper" class="fade-in">
                  <!-- Intro 头部显示 s -->
                  <!-- Intro 头部显示 e -->
                  <!-- Header 头部logo start -->
                  <header id="header">
    <a href="/" class="logo">Think Different</a>
</header>
                    <!-- Nav 导航条 start -->
                    <nav id="nav" class="special" >
            <ul class="menu links" >
			<!-- Homepage  主页  --> 
			<li >
	            <a href="/" rel="nofollow">Home</a>
	        </li>
			<!-- categories_name  分类   --> 
	        
	        <li class="active">
	            <a href="#s1">Categories</a>
	                    <ul class="submenu">
	                        <li>
	                        <a class="category-link" href="/categories/Contests/">Contests</a></li><li><a class="category-link" href="/categories/Engineering/">Engineering</a></li><li><a class="category-link" href="/categories/Essays/">Essays</a></li><li><a class="category-link" href="/categories/Mathematics/">Mathematics</a></li><li><a class="category-link" href="/categories/Notes/">Notes</a>
	                    </ul>
	        </li>
	        
	        <!-- archives  归档   --> 
	        
	        <li class="active">
	            <a href="#s1">Archives</a>
	                    <ul class="submenu">
	                        <li>
	                        <a class="archive-link" href="/archives/2022/08/">August 2022</a></li><li><a class="archive-link" href="/archives/2022/07/">July 2022</a></li><li><a class="archive-link" href="/archives/2022/06/">June 2022</a></li><li><a class="archive-link" href="/archives/2022/05/">May 2022</a></li><li><a class="archive-link" href="/archives/2022/04/">April 2022</a></li><li><a class="archive-link" href="/archives/2022/03/">March 2022</a></li><li><a class="archive-link" href="/archives/2022/02/">February 2022</a></li><li><a class="archive-link" href="/archives/2022/01/">January 2022</a></li><li><a class="archive-link" href="/archives/2021/11/">November 2021</a></li><li><a class="archive-link" href="/archives/2021/10/">October 2021</a></li><li><a class="archive-link" href="/archives/2021/08/">August 2021</a></li><li><a class="archive-link" href="/archives/2020/11/">November 2020</a>
	                    </ul>
	        </li>
	        
	        
		        <!-- Pages 自定义   -->
		        
		        <li>
		            <a href="/about/" title="About">
		                About
		            </a>
		        </li>
		        
		        <li>
		            <a href="/group/" title="Friends">
		                Friends
		            </a>
		        </li>
		        
		        <li>
		            <a href="/gallery/" title="Gallery">
		                Gallery
		            </a>
		        </li>
		        
		        <li>
		            <a href="/tag/" title="Tags">
		                Tags
		            </a>
		        </li>
		        


            </ul>
            <!-- icons 图标   -->
			<ul class="icons">
                    
                    <li>
                        <a title="github" href="https://github.com/Wild-Donkey" target="_blank" rel="noopener">
                            <i class="icon fa fa-github"></i>
                        </a>
                    </li>
                    
			</ul>
</nav>

                      <div id="main">
                        <div class="post_page_title_img"
                          style="height: 25rem;background-image: url(https://wild-donkey-gallery.oss-cn-hangzhou.aliyuncs.com/BlogImg/GTA6.png);background-position: center; background-repeat:no-repeat; background-size:cover;-moz-background-size:cover;overflow:hidden;">
                          <a href="#" style="padding: 4rem 4rem 2rem 4rem ;">
                            <h2>
                              SDOI2022 退役记
                            </h2>
                          </a>
                        </div>
                        <!-- Post -->
                        <div class="typo" style="padding: 3rem;">
                          <h1 id="生涯转折点-sdoi2022"><a class="markdownIt-Anchor" href="#生涯转折点-sdoi2022"></a> 生涯转折点 SDOI2022</h1>
<p>先说结果, 期望 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>20</mn><mo>+</mo><mn>35</mn><mo>+</mo><mn>25</mn><mo>+</mo><mn>100</mn><mo>+</mo><mn>10</mn><mo>+</mo><mn>0</mn><mo>=</mo><mn>190</mn></mrow><annotation encoding="application/x-tex">20 + 35 + 25 + 100 + 10 + 0 = 190</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">3</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">9</span><span class="mord">0</span></span></span></span>, 实际挂成了 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn><mo>+</mo><mn>35</mn><mo>+</mo><mn>25</mn><mo>+</mo><mn>100</mn><mo>+</mo><mn>2</mn><mo>+</mo><mn>0</mn><mo>=</mo><mn>162</mn></mrow><annotation encoding="application/x-tex">0 + 35 + 25 + 100 + 2 + 0 = 162</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">3</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">6</span><span class="mord">2</span></span></span></span>. 山东 RK <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>24</mn></mrow><annotation encoding="application/x-tex">24</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord">4</span></span></span></span>, 加上 NOIP 成绩 RK <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>23</mn></mrow><annotation encoding="application/x-tex">23</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord">3</span></span></span></span>. 肯定没有 AB 了, 但是 D 是绝对可以买的.</p>
<h2 id="d1t1-整数序列"><a class="markdownIt-Anchor" href="#d1t1-整数序列"></a> D1T1 整数序列</h2>
<p>这个题一眼没什么想法, 转化题意为每次询问数轴上有两种点, 选择一个区间使得两种点数量相同且权值总和最大.</p>
<p>之后想到可以类似于括号匹配那样做, 将每个数字的每次出现位置和权值都存到一个 <code>vector</code> 里面, 记录一个高度 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>h</mi></mrow><annotation encoding="application/x-tex">h</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">h</span></span></span></span>, 从左往右双指针扫描两个 <code>vector</code>, 遇到第一种点就将高度增加 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>, 遇到第二种点就将高度减少 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>, 记录每个高度达到过的最小权值前缀和, 每次用当前的高度和前缀和减去这个高度达到过的最小权值前缀和, 尝试更新答案. 复杂度 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mi>q</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(nq)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mclose">)</span></span></span></span>.</p>
<p>其实这个数据范围结合时限 (当时还没有改时限, 貌似是 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>4</mn><mi>s</mi></mrow><annotation encoding="application/x-tex">4s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">4</span><span class="mord mathdefault">s</span></span></span></span>), 我是十分相信存在根号做法的, 但无论是分块还是莫队我都没有想到什么合理的算法. 将时间改到 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>7</mn><mi>s</mi></mrow><annotation encoding="application/x-tex">7s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">7</span><span class="mord mathdefault">s</span></span></span></span> 之后, 我更加相信这个题绝对是根号, 但是仍无果.</p>
<p>我中途想过每个点开一个动态开点线段树, 可是这个信息无法通过线段树的二分结构来查询, 所以就寄了. 发现可以根号分治, 也就是特殊处理出现次数大于根号个的元素, 通过预处理加速和这些元素有关的询问, 但是发现我不会预处理加速询问, 所以就又往动态开点线段树上去想了.</p>
<p>最后还是交的 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mi>q</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(nq)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mclose">)</span></span></span></span>, 但是没有得到预期的 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn><msup><mn>0</mn><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">20&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>, 因为有一个地方挂掉了. 接下来是考场代码:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bitset&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">unsigned</span> <span class="title">RD</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="type">unsigned</span> <span class="title">Rtmp</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">  <span class="function"><span class="type">char</span> <span class="title">Rch</span><span class="params">(getchar())</span></span>;</span><br><span class="line">  <span class="keyword">while</span>(Rch &lt; <span class="string">&#x27;0&#x27;</span> || Rch &gt; <span class="string">&#x27;9&#x27;</span>) Rch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span>(Rch &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; Rch &lt;= <span class="string">&#x27;9&#x27;</span>)</span><br><span class="line">    Rtmp = Rtmp * <span class="number">10</span> + Rch - <span class="string">&#x27;0&#x27;</span>, Rch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">return</span> Rtmp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">RDsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">Rtmp</span><span class="params">(<span class="number">0</span>)</span>, <span class="title">Rsig</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">  <span class="function"><span class="type">char</span> <span class="title">Rch</span><span class="params">(getchar())</span></span>;</span><br><span class="line">  <span class="keyword">while</span>((Rch &lt; <span class="string">&#x27;0&#x27;</span> || Rch &gt; <span class="string">&#x27;9&#x27;</span>) &amp;&amp; (Rch ^ <span class="string">&#x27;-&#x27;</span>)) Rch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">if</span>(Rch == <span class="string">&#x27;-&#x27;</span>) Rsig = <span class="number">-1</span>, Rch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span>(Rch &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; Rch &lt;= <span class="string">&#x27;9&#x27;</span>)</span><br><span class="line">    Rtmp = Rtmp * <span class="number">10</span> + Rch - <span class="string">&#x27;0&#x27;</span>, Rch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">return</span> Rtmp * Rsig;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> Sum[<span class="number">600005</span>], <span class="built_in">Ans</span>(<span class="number">0</span>);</span><br><span class="line"><span class="type">unsigned</span> a[<span class="number">300005</span>];</span><br><span class="line"><span class="type">int</span> b[<span class="number">300005</span>];</span><br><span class="line">vector&lt;pair&lt;<span class="type">unsigned</span>, <span class="type">int</span>&gt; &gt; c[<span class="number">300005</span>];</span><br><span class="line"><span class="type">unsigned</span> n, m;</span><br><span class="line"><span class="type">unsigned</span> A, B, C, D, t;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">freopen</span>(<span class="string">&quot;sequence.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin);</span><br><span class="line"><span class="comment">//  freopen(&quot;ex_sequence3.in&quot;, &quot;r&quot;, stdin);</span></span><br><span class="line">  <span class="built_in">freopen</span>(<span class="string">&quot;sequence.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout);</span><br><span class="line">  n = <span class="built_in">RD</span>(), m = <span class="built_in">RD</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt;= n; ++i) a[i] = <span class="built_in">RD</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt;= n; ++i) b[i] = <span class="built_in">RDsg</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt;= n; ++i) c[a[i]].<span class="built_in">push_back</span>(&#123;i, b[i]&#125;);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt;= m; ++i) &#123;</span><br><span class="line">    C = c[A = <span class="built_in">RD</span>()].<span class="built_in">size</span>(), D = c[B = <span class="built_in">RD</span>()].<span class="built_in">size</span>();</span><br><span class="line">    <span class="function"><span class="type">unsigned</span> <span class="title">Hei</span><span class="params">(n)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">long</span> <span class="type">long</span> <span class="title">Cur</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">    <span class="built_in">memset</span>(Sum, <span class="number">0x3f</span>, (n + <span class="number">1</span>) &lt;&lt; <span class="number">4</span>);</span><br><span class="line">    Sum[n] = <span class="number">0</span>, Ans = <span class="number">0xafafafafafafafaf</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">j</span>(<span class="number">0</span>), <span class="built_in">k</span>(<span class="number">0</span>); j &lt; C || k &lt; D; ) &#123;</span><br><span class="line">      <span class="keyword">if</span>((j ^ C) &amp;&amp; ((k == D) || (c[A][j].first &lt; c[B][k].first))) &#123;</span><br><span class="line">        Cur = Cur + c[A][j].second;</span><br><span class="line">        Ans = <span class="built_in">max</span>(Cur - Sum[Hei + <span class="number">1</span>], Ans);</span><br><span class="line">        Sum[Hei + <span class="number">1</span>] = <span class="built_in">min</span>(Sum[Hei] + c[A][j].second, Sum[Hei + <span class="number">1</span>]);</span><br><span class="line">        ++Hei, ++j;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>((k ^ D) &amp;&amp; ((j == C) || (c[A][j].first &gt; c[B][k].first))) &#123;</span><br><span class="line">        Cur = Cur + c[B][k].second;</span><br><span class="line">        Ans = <span class="built_in">max</span>(Cur - Sum[Hei - <span class="number">1</span>], Ans);</span><br><span class="line">        Sum[Hei - <span class="number">1</span>] = <span class="built_in">min</span>(Sum[Hei] + c[B][k].second, Sum[Hei - <span class="number">1</span>]);</span><br><span class="line">        --Hei, ++k;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, Ans);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>锅出在更新 <code>Sum</code> 数组上, 我使用的是:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">Sum[Hei + <span class="number">1</span>] = <span class="built_in">min</span>(Sum[Hei] + c[A][j].second, Sum[Hei + <span class="number">1</span>]);</span><br><span class="line">...</span><br><span class="line">Sum[Hei - <span class="number">1</span>] = <span class="built_in">min</span>(Sum[Hei] + c[B][k].second, Sum[Hei - <span class="number">1</span>]);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>这是用历史最低的值尝试更新这个历史最低的值, 但是真实情况是应该用当前值去更新这个历史最低值. 因此只要改成这样就正确了, 可以拿到 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn><msup><mn>0</mn><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">20&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">Sum[Hei + <span class="number">1</span>] = <span class="built_in">min</span>(Cur, Sum[Hei + <span class="number">1</span>]);</span><br><span class="line">...</span><br><span class="line">Sum[Hei - <span class="number">1</span>] = <span class="built_in">min</span>(Cur, Sum[Hei - <span class="number">1</span>]);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>这道题的正解确实是根号分治, 原理是出现次数大于 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span></span></span></span> 的元素不超过 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mi>n</mi><mi>B</mi></mfrac></mrow><annotation encoding="application/x-tex">\frac nB</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.040392em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.695392em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05017em;">B</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> 个, 把这些元素称为主要元素. 所以可以将询问分为两种: 含有主要元素和不含有主要元素.</p>
<p>对于询问 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x, y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span> 有两种回答询问的方式: 第一种是 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>S</mi><mi>i</mi><mi>z</mi><msub><mi>e</mi><mi>x</mi></msub><mo>+</mo><mi>S</mi><mi>i</mi><mi>z</mi><msub><mi>e</mi><mi>y</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(Size_x + Size_y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>, 也就是暴力, 第二种是对 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>i</mi><mi>z</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">Size</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mord mathdefault">e</span></span></span></span> 较大的元素经过 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span> 的预处理之后, 可以进行 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>min</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>S</mi><mi>i</mi><mi>z</mi><msub><mi>e</mi><mi>x</mi></msub><mo separator="true">,</mo><mi>S</mi><mi>i</mi><mi>z</mi><msub><mi>e</mi><mi>y</mi></msub><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(\min(Size_x, Size_y))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mop">min</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span> 的询问.</p>
<p>把所有询问的两个元素中出现次数较多的放在前面, 然后按询问的第一个元素为第一关键字, 第二个元素为第二关键字排序.</p>
<p>对于不含有主要元素的询问, 我们直接暴力查询, 复杂度为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(B)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mclose">)</span></span></span></span>. 有主要元素的询问, 我们对于每个主要元素, 进行 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span> 预处理后, 一次性询问所有的包含它的询问. 由于包含它的所有询问的另一个元素的出现次数总和不超过 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span>, 因此用第二种询问方式可以 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mi>log</mi><mo>⁡</mo><mi>B</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n\log B)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mclose">)</span></span></span></span> 求出所有询问的答案. 一共最多有 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mi>n</mi><mi>B</mi></mfrac></mrow><annotation encoding="application/x-tex">\frac nB</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.040392em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.695392em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05017em;">B</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> 个主要元素, 总复杂度 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>B</mi><mi>q</mi><mo>+</mo><mfrac><mrow><msup><mi>n</mi><mn>2</mn></msup><mi>log</mi><mo>⁡</mo><mi>B</mi></mrow><mi>B</mi></mfrac><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(Bq + \frac{n^2\log B}B)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.415028em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.070028em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05017em;">B</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.446108em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913142857142857em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace mtight" style="margin-right:0.19516666666666668em;"></span><span class="mop mtight">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace mtight" style="margin-right:0.19516666666666668em;"></span><span class="mord mathdefault mtight" style="margin-right:0.05017em;">B</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span></span></span>, 如果认为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>log</mi><mo>⁡</mo><mi>B</mi></mrow><annotation encoding="application/x-tex">\log B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>log</mi><mo>⁡</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">\log n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span></span></span></span> 同阶, 那么当 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span></span></span></span> 取 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi>n</mi><mi>log</mi><mo>⁡</mo><mi>n</mi></mrow><msqrt><mi>q</mi></msqrt></mfrac></mrow><annotation encoding="application/x-tex">\frac {n\log n}{\sqrt q}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.5091364999999999em;vertical-align:-0.5769205em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322159999999999em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.708685em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathdefault mtight" style="margin-right:0.03588em;padding-left:0.833em;">q</span></span><span style="top:-2.668685em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.33131499999999997em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.446108em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mspace mtight" style="margin-right:0.19516666666666668em;"></span><span class="mop mtight">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace mtight" style="margin-right:0.19516666666666668em;"></span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5769205em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> 时复杂度最优, 为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><msqrt><mrow><mi>q</mi><mi>log</mi><mo>⁡</mo><mi>n</mi></mrow></msqrt><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n\sqrt {q\log n})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.085em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.835em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span></span></span><span style="top:-2.795em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.20500000000000007em;"><span></span></span></span></span></span><span class="mclose">)</span></span></span></span>. 一开始给询问排序是 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>q</mi><mi>log</mi><mo>⁡</mo><mi>q</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(q \log q)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mclose">)</span></span></span></span>, 可以开桶优化到 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo>+</mo><mi>q</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n + q)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mclose">)</span></span></span></span>.</p>
<p>我一开始认为的第二种询问: 对于一个主要元素 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">A</span></span></span></span>, 直接扫描整个数组 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">a</span></span></span></span>, 同时维护每个询问的每个高度的前缀和历史最小值, 但是如果序列上扫过一个 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">A</span></span></span></span>, 就需要更新所有询问的高度和对应的历史最小前缀和, 复杂度会退化成 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mi>q</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(nq)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mclose">)</span></span></span></span>.</p>
<p>真正的第二种询问方式是这样的: 我们暴力查询的时候相当于维护了一个折线, 把折线中一段首尾高度相同的非空子区间拿出来, 这个子区间的权值就可以更新答案. 那么我们考虑这个首尾相同的高度可能的取值范围, 把折线分成长度为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> 的小段, 这些段的上升和下降对应了这个位置的元素是第一种还是第二种.</p>
<p>满足条件的高度一定是某个下降段的端点高度, 对于一个仅末尾经过起始高度的子区间, 由于只经过子区间起点所在的高度两次, 所以整个子区间的折线应该在这个高度的水平线的一侧, 如果是在上侧, 那么该子区间以上升段开始, 下降段结束, 否则以下降段开始, 上升段结束, 因此这个高度一定是某个下降段的端点所在高度. 对于任意可以更新答案的子区间, 把它从每一次经过首尾高度的位置断开, 每个部分都是一个前面分析过的子区间, 所以每一个部分都有一个下降段的端点高度为对应高度. (显然对于上升段这个结论仍然适用)</p>
<p>有了这个结论, 那么对于一个有 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span> 个下降段的折线, 有效的高度只有最多 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn><mi>x</mi></mrow><annotation encoding="application/x-tex">2x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord mathdefault">x</span></span></span></span> 个, 将这些高度称为关键高度. 我们只需要维护这些高度的历史最小前缀和, 并且在尝试更新每个高度的历史最小前缀和之前尝试更新答案即可. 在处理以主要元素 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">A</span></span></span></span> 为询问的第一个元素, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span></span></span></span> 为询问的第二个元素的时候, 为了快速找出关键高度, 需要给每次 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span></span></span></span> 出现的时候定位. 我们预处理每一个位置及之前 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">A</span></span></span></span> 的数量, 然后从左到右扫描 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span></span></span></span>, 用每个 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span></span></span></span> 出现时, 左边 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">A</span></span></span></span> 的数量和这个 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span></span></span></span> 的编号做差即可得到当前下降段终点的高度, 下降段起点的高度就是终点高度加 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>. 最后将所有关键高度排序去重即可, 复杂度中 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>log</mi><mo>⁡</mo><mi>B</mi></mrow><annotation encoding="application/x-tex">\log B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span></span></span></span> 就来自这个排序.</p>
<p>知道了关键高度, 接下来就从左往右跳, 遇到连续极长上升子区间就每次 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span> 从一个关键高度走到下一个关键高度, 预处理这个元素 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span></span></span></span> 值的前缀和查询区间总和. 每次到一个关键高度尝试更新答案和前缀历史最小和.</p>
<p>这个题的数据比较难构造, 因为要卡掉所有错做法, 这个题如果把 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span></span></span></span> 设为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>, 可以拿到 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>4</mn><msup><mn>5</mn><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">45&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord">4</span><span class="mord"><span class="mord">5</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>, 把 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span></span></span></span> 设为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span> 可以 AC, 也就是说只要把出现两次及以上的都当作主要元素就可以 AC.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> a[<span class="number">300005</span>], Sz[<span class="number">300005</span>], Name[<span class="number">300005</span>], Bucket[<span class="number">300005</span>];</span><br><span class="line"><span class="type">int</span> b[<span class="number">300005</span>];</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> Sum[<span class="number">300005</span>], Ans[<span class="number">1000005</span>];</span><br><span class="line"><span class="type">unsigned</span> A, B, C, D, t;</span><br><span class="line"><span class="type">unsigned</span> Cnt, Mx, Thr, m, n;</span><br><span class="line">vector&lt;pair&lt;<span class="type">unsigned</span>, <span class="type">int</span>&gt; &gt; Vc[<span class="number">300005</span>];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Ques</span> &#123;</span><br><span class="line">  <span class="type">unsigned</span> Fs, Sc, Num;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Num = ++Cnt, <span class="built_in">gi</span>(A), Fs = Bucket[A], <span class="built_in">gi</span>(A), Sc = Bucket[A];</span><br><span class="line">    <span class="keyword">if</span> (Fs &lt; Sc) <span class="built_in">swap</span>(Fs, Sc);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">inline</span> <span class="type">const</span> <span class="type">char</span> <span class="keyword">operator</span>&lt; (<span class="type">const</span> Ques&amp; x) <span class="type">const</span> &#123; <span class="keyword">return</span> (Fs ^ x.Fs) ? (Fs &lt; x.Fs) : (Sc &lt; x.Sc); &#125;</span><br><span class="line">&#125;Qst[<span class="number">1000005</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">long</span> <span class="type">long</span> <span class="title">Qry</span><span class="params">(<span class="type">unsigned</span> x)</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="type">unsigned</span> <span class="title">Siz</span><span class="params">(Vc[x].size())</span>, Hei[Siz + 3], List[<span class="params">(Siz &lt;&lt; <span class="number">1</span>)</span> + 3]</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">0</span>); i &lt; Siz; ++i) Hei[i + <span class="number">1</span>] = Siz + Bucket[Vc[x][i].first] - i - <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">memcpy</span>(List, Hei, (Siz + <span class="number">1</span>) &lt;&lt; <span class="number">2</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt;= Siz; ++i) List[Siz + i] = List[i] + <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">sort</span>(List + <span class="number">1</span>, List + (Siz &lt;&lt; <span class="number">1</span>) + <span class="number">1</span>);</span><br><span class="line">  <span class="function"><span class="type">unsigned</span> <span class="title">HCnt</span><span class="params">(unique(List + <span class="number">1</span>, List + (Siz &lt;&lt; <span class="number">1</span>) + <span class="number">1</span>) - List - <span class="number">1</span>)</span></span>;</span><br><span class="line">  List[HCnt + <span class="number">1</span>] = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line">  <span class="type">long</span> <span class="type">long</span> Shrink[HCnt + <span class="number">3</span>], <span class="built_in">Cur</span>(<span class="number">0</span>), <span class="built_in">Tmp</span>(<span class="number">0xafafafafafafafaf</span>);</span><br><span class="line">  <span class="built_in">memset</span>(Shrink, <span class="number">0x3f</span>, (HCnt + <span class="number">1</span>) &lt;&lt; <span class="number">3</span>);</span><br><span class="line">  <span class="function"><span class="type">unsigned</span> <span class="title">j</span><span class="params">(<span class="number">0</span>)</span>, <span class="title">HC</span><span class="params">(Siz)</span>, <span class="title">Pos</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">  <span class="keyword">while</span> (List[j + <span class="number">1</span>] &lt;= Siz) ++j;</span><br><span class="line">  <span class="keyword">if</span> (List[j] == Siz) Shrink[j] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt;= Siz; ++i) &#123;</span><br><span class="line">    <span class="keyword">while</span> (List[j + <span class="number">1</span>] &lt;= Hei[i] + <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="function"><span class="type">unsigned</span> <span class="title">Fw</span><span class="params">(min(Mx - Pos, List[++j] - HC))</span></span>;</span><br><span class="line">      <span class="keyword">if</span> (!Fw) <span class="keyword">continue</span>;</span><br><span class="line">      Cur -= Sum[Pos], Cur += Sum[Pos += Fw];</span><br><span class="line">      HC = List[j], Tmp = <span class="built_in">max</span>(Tmp, Cur - Shrink[j]);</span><br><span class="line">      Shrink[j] = <span class="built_in">min</span>(Shrink[j], Cur);</span><br><span class="line">    &#125;</span><br><span class="line">    Cur += Vc[x][i - <span class="number">1</span>].second, --j;</span><br><span class="line">    --HC, Tmp = <span class="built_in">max</span>(Tmp, Cur - Shrink[j]);</span><br><span class="line">    Shrink[j] = <span class="built_in">min</span>(Shrink[j], Cur);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> (j &lt; HCnt) &#123;</span><br><span class="line">    <span class="function"><span class="type">unsigned</span> <span class="title">Fw</span><span class="params">(min(Mx - Pos, List[++j] - HC))</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (!Fw) <span class="keyword">continue</span>;</span><br><span class="line">    Cur -= Sum[Pos], Cur += Sum[Pos += Fw];</span><br><span class="line">    HC = List[j], Tmp = <span class="built_in">max</span>(Tmp, Cur - Shrink[j]);</span><br><span class="line">    Shrink[j] = <span class="built_in">min</span>(Shrink[j], Cur);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> Tmp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">gi</span>(n), <span class="built_in">gi</span>(m), Thr = (n / (<span class="built_in">sqrt</span>(m) + <span class="number">1</span>)) + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt;= n; ++i) <span class="built_in">gi</span>(a[i]), ++Sz[a[i]];</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt;= n; ++i) <span class="built_in">gi</span>(b[i]);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt;= n; ++i) ++Bucket[Sz[i]];</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt;= n; ++i) Bucket[i] += Bucket[i - <span class="number">1</span>];</span><br><span class="line">  Thr = Bucket[Thr - <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(n); i; --i) Name[Bucket[Sz[i]]--] = i; <span class="comment">//Rank</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt;= n; ++i) Bucket[Name[i]] = i;<span class="comment">// Bucket -&gt; Name</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt;= n; ++i) Vc[a[i] = Bucket[a[i]]].<span class="built_in">push_back</span>(&#123; i, b[i] &#125;);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt;= m; ++i) Qst[i].<span class="built_in">Init</span>();</span><br><span class="line">  <span class="built_in">sort</span>(Qst + <span class="number">1</span>, Qst + m + <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(Cnt = <span class="number">1</span>); i &lt;= m; ++i, ++Cnt) &#123;</span><br><span class="line">    <span class="function"><span class="type">unsigned</span> <span class="title">Cur</span><span class="params">(Qst[i].Fs)</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (Cur &gt;= Thr) <span class="keyword">break</span>;</span><br><span class="line">    <span class="function"><span class="type">unsigned</span> <span class="title">With</span><span class="params">(Qst[i].Sc)</span>, <span class="title">Mxk</span><span class="params">(Vc[With].size())</span>, <span class="title">Top</span><span class="params">(Thr + <span class="number">2</span>)</span>, <span class="title">Hei</span><span class="params">(Top)</span>, <span class="title">Bot</span><span class="params">(Top)</span>, <span class="title">k</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">long</span> <span class="type">long</span> <span class="title">CSum</span><span class="params">(<span class="number">0</span>)</span>, <span class="title">Tmp</span><span class="params">(<span class="number">0xafafafafafafafaf</span>)</span></span>;</span><br><span class="line">    Sum[Top] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> j : Vc[Cur]) &#123;</span><br><span class="line">      <span class="keyword">while</span> (k &lt; Mxk &amp;&amp; Vc[With][k].first &lt; j.first) &#123;</span><br><span class="line">        CSum += Vc[With][k++].second, --Hei;</span><br><span class="line">        <span class="keyword">if</span> (Hei &lt; Bot) Sum[Bot = Hei] = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line">        Tmp = <span class="built_in">max</span>(Tmp, CSum - Sum[Hei]);</span><br><span class="line">        Sum[Hei] = <span class="built_in">min</span>(CSum, Sum[Hei]);</span><br><span class="line">      &#125;</span><br><span class="line">      CSum += j.second, ++Hei;</span><br><span class="line">      <span class="keyword">if</span> (Hei &gt; Top) Sum[Top = Hei] = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line">      Tmp = <span class="built_in">max</span>(Tmp, CSum - Sum[Hei]);</span><br><span class="line">      Sum[Hei] = <span class="built_in">min</span>(CSum, Sum[Hei]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (k &lt; Mxk) &#123;</span><br><span class="line">      CSum += Vc[With][k++].second, --Hei;</span><br><span class="line">      <span class="keyword">if</span> (Hei &lt; Bot) Sum[Bot = Hei] = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line">      Tmp = <span class="built_in">max</span>(Tmp, CSum - Sum[Hei]);</span><br><span class="line">      Sum[Hei] = <span class="built_in">min</span>(CSum, Sum[Hei]);</span><br><span class="line">    &#125;</span><br><span class="line">    Ans[Qst[i].Num] = Tmp;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(Cnt); i &lt;= m;) &#123;</span><br><span class="line">    <span class="function"><span class="type">unsigned</span> <span class="title">Cur</span><span class="params">(Qst[i].Fs)</span></span>;</span><br><span class="line">    <span class="built_in">memset</span>(Bucket, <span class="number">0</span>, (n + <span class="number">1</span>) &lt;&lt; <span class="number">2</span>);</span><br><span class="line">    Sum[<span class="number">0</span>] = <span class="number">0</span>, Mx = Vc[Cur].<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">j</span>(Mx); j; --j) Sum[j] = Vc[Cur][j - <span class="number">1</span>].second;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> j : Vc[Cur]) Bucket[j.first] = <span class="number">1</span>;<span class="comment">// Sum[j.first] = j.second;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">j</span>(<span class="number">1</span>); j &lt;= n; ++j) Bucket[j] += Bucket[j - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">j</span>(<span class="number">1</span>); j &lt;= Mx; ++j) Sum[j] += Sum[j - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">while</span> (Qst[i].Fs == Cur) &#123;</span><br><span class="line">      <span class="keyword">if</span> ((Qst[i - <span class="number">1</span>].Fs == Cur) &amp;&amp; (Qst[i].Sc == Qst[i - <span class="number">1</span>].Sc)) &#123;</span><br><span class="line">        Ans[Qst[i].Num] = Ans[Qst[i - <span class="number">1</span>].Num], ++i;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      Ans[Qst[i].Num] = <span class="built_in">Qry</span>(Qst[i].Sc), ++i;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt;= m; ++i) <span class="built_in">print</span>(Ans[i]), <span class="built_in">pc</span>(<span class="number">0x0A</span>);</span><br><span class="line">  <span class="keyword">return</span> Wild_Donkey;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="d1t2-进制转换"><a class="markdownIt-Anchor" href="#d1t2-进制转换"></a> D1T2 进制转换</h2>
<p>求 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mi>o</mi><mi>p</mi><mi>c</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">Popcnt</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mord mathdefault">o</span><span class="mord mathdefault">p</span><span class="mord mathdefault">c</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span></span></span></span> 有关的多项式, 显然线性是送的, 又因为是一个多项式的形式, 所以一眼出了 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">y = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> 的做法, 就是倍增. 这就拿到了 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>3</mn><msup><mn>5</mn><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">35&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord">3</span><span class="mord"><span class="mord">5</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>.</p>
<p>如果要细说这个倍增的方法, 假设 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi><mo>&lt;</mo><msup><mn>3</mn><mi>k</mi></msup></mrow><annotation encoding="application/x-tex">d &lt; 3^k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73354em;vertical-align:-0.0391em;"></span><span class="mord mathdefault">d</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.849108em;vertical-align:0em;"></span><span class="mord"><span class="mord">3</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span></span></span></span>, 我们考虑 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>x</mi><mi>d</mi></msup><msup><mi>z</mi><msub><mi>b</mi><mi>d</mi></msub></msup></mrow><annotation encoding="application/x-tex">x^d z^{b_d}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.849108em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">d</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15122857142857138em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>x</mi><mrow><msup><mn>3</mn><mi>k</mi></msup><mo>+</mo><mi>d</mi></mrow></msup><msup><mi>z</mi><msub><mi>b</mi><mrow><msup><mn>3</mn><mi>k</mi></msup><mo>+</mo><mi>d</mi></mrow></msub></msup></mrow><annotation encoding="application/x-tex">x^{3^k + d} z^{b_{3^k + d}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.01192em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.01192em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9270285714285713em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mathdefault mtight">d</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8883829999999999em;"><span style="top:-3.1022750000000006em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.34480000000000005em;"><span style="top:-2.3448em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.7060285714285714em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.98844em;"><span style="top:-2.98844em;margin-right:0.1em;"><span class="pstrut" style="height:2.69444em;"></span><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mathdefault mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.42075em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> 的关系, 发现 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>x</mi><mrow><msup><mn>3</mn><mi>k</mi></msup><mo>+</mo><mi>d</mi></mrow></msup><msup><mi>z</mi><msub><mi>b</mi><mrow><msup><mn>3</mn><mi>k</mi></msup><mo>+</mo><mi>d</mi></mrow></msub></msup><mo>=</mo><mo stretchy="false">(</mo><msup><mi>x</mi><mi>d</mi></msup><msup><mi>z</mi><msub><mi>b</mi><mi>d</mi></msub></msup><mo stretchy="false">)</mo><msup><mi>x</mi><msup><mn>3</mn><mi>k</mi></msup></msup><mi>z</mi></mrow><annotation encoding="application/x-tex">x^{3^k + d} z^{b_{3^k + d}} = (x^d z^{b_d}) x^{3^k} z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.01192em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.01192em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9270285714285713em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mathdefault mtight">d</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8883829999999999em;"><span style="top:-3.1022750000000006em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.34480000000000005em;"><span style="top:-2.3448em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.7060285714285714em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.98844em;"><span style="top:-2.98844em;margin-right:0.1em;"><span class="pstrut" style="height:2.69444em;"></span><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mathdefault mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.42075em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.26192em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">d</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15122857142857138em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.01192em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9270285714285713em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span></span></span></span>, 以此类推 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>x</mi><mrow><mn>2</mn><mo>×</mo><msup><mn>3</mn><mi>k</mi></msup><mo>+</mo><mi>d</mi></mrow></msup><msup><mi>z</mi><msub><mi>b</mi><mrow><mn>2</mn><mo>×</mo><msup><mn>3</mn><mi>k</mi></msup><mo>+</mo><mi>d</mi></mrow></msub></msup><mo>=</mo><mo stretchy="false">(</mo><msup><mi>x</mi><mi>d</mi></msup><msup><mi>z</mi><msub><mi>b</mi><mi>d</mi></msub></msup><mo stretchy="false">)</mo><msup><mi>x</mi><mrow><mn>2</mn><mo>×</mo><msup><mn>3</mn><mi>k</mi></msup></mrow></msup><msup><mi>z</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">x^{2 \times 3^k + d} z^{b_{2 \times 3^k + d}} = (x^d z^{b_d}) x^{2 \times 3^k} z^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.01192em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.01192em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mbin mtight">×</span><span class="mord mtight"><span class="mord mtight">3</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9270285714285713em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mathdefault mtight">d</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8883829999999999em;"><span style="top:-3.1022750000000006em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.34480000000000005em;"><span style="top:-2.3448em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.7060285714285714em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mbin mtight">×</span><span class="mord mtight"><span class="mord mtight">3</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.98844em;"><span style="top:-2.98844em;margin-right:0.1em;"><span class="pstrut" style="height:2.69444em;"></span><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mathdefault mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.42075em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.26192em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">d</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15122857142857138em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.01192em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mbin mtight">×</span><span class="mord mtight"><span class="mord mtight">3</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9270285714285713em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>. 也就是说如果我们知道了 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle scriptlevel="0" displaystyle="true"><mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mrow><msup><mn>3</mn><mi>k</mi></msup><mo>−</mo><mn>1</mn></mrow></munderover><msup><mi>x</mi><mi>d</mi></msup><msup><mi>z</mi><msub><mi>b</mi><mi>d</mi></msub></msup></mrow></mstyle></mrow><annotation encoding="application/x-tex">\displaystyle{\sum_{i = 0}^{3^k - 1} x^dz^{b_d}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.2765940000000002em;vertical-align:-1.277669em;"></span><span class="mord"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.9989250000000003em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.300005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9270285714285713em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">d</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999998em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15122857142857138em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>, 那么我们就可以 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span> 求出 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle scriptlevel="0" displaystyle="true"><mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mrow><msup><mn>3</mn><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msup><mo>−</mo><mn>1</mn></mrow></munderover><msup><mi>x</mi><mi>d</mi></msup><msup><mi>z</mi><msub><mi>b</mi><mi>d</mi></msub></msup></mrow></mstyle></mrow><annotation encoding="application/x-tex">\displaystyle{\sum_{i = 0}^{3^{k + 1} - 1} x^dz^{b_d}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.2765940000000002em;vertical-align:-1.277669em;"></span><span class="mord"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.9989250000000003em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.300005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9270285714285714em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">d</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999998em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15122857142857138em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>.</p>
<p>因此只需要 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mo><mi>log</mi><mo>⁡</mo></mo><mn>3</mn></msub><mi>n</mi></mrow><annotation encoding="application/x-tex">\log_3 n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.93858em;vertical-align:-0.24414em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.20696799999999996em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span></span></span></span> 即可求出 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">y = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> 的情况.</p>
<p>下面是考场 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>3</mn><msup><mn>5</mn><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">35&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord">3</span><span class="mord"><span class="mord">5</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span> 代码:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bitset&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> <span class="title">RD</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> <span class="title">Rtmp</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">  <span class="function"><span class="type">char</span> <span class="title">Rch</span><span class="params">(getchar())</span></span>;</span><br><span class="line">  <span class="keyword">while</span>(Rch &lt; <span class="string">&#x27;0&#x27;</span> || Rch &gt; <span class="string">&#x27;9&#x27;</span>) Rch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span>(Rch &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; Rch &lt;= <span class="string">&#x27;9&#x27;</span>)</span><br><span class="line">    Rtmp = Rtmp * <span class="number">10</span> + Rch - <span class="string">&#x27;0&#x27;</span>, Rch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">return</span> Rtmp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">const</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> <span class="title">Mod</span><span class="params">(<span class="number">998244353</span>)</span></span>;</span><br><span class="line"><span class="type">unsigned</span> a[<span class="number">10000005</span>], b[<span class="number">10000005</span>];</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> n, m;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> A, B, C[<span class="number">3</span>], <span class="built_in">Ans</span>(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> <span class="title">Pow</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> x, <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> y)</span> </span>&#123;</span><br><span class="line">  y %= <span class="number">998244352</span>, x %= Mod;</span><br><span class="line">  <span class="function"><span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> <span class="title">Rt</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">  <span class="keyword">while</span> (y) &#123;<span class="keyword">if</span>(y &amp; <span class="number">1</span>) Rt = Rt * x % Mod; x = x * x % Mod, y &gt;&gt;= <span class="number">1</span>;&#125;</span><br><span class="line">  <span class="keyword">return</span> Rt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">unsigned</span> <span class="title">PpC3</span> <span class="params">(<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> x)</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="type">unsigned</span> <span class="title">Rt</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">  <span class="keyword">while</span> (x) Rt += x % <span class="number">3</span>, x /= <span class="number">3</span>;</span><br><span class="line">  <span class="keyword">return</span> Rt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">freopen</span>(<span class="string">&quot;conversion.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin);</span><br><span class="line"><span class="comment">//  freopen(&quot;ex_conversion2.in&quot;, &quot;r&quot;, stdin);</span></span><br><span class="line">  <span class="built_in">freopen</span>(<span class="string">&quot;conversion.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout);</span><br><span class="line">  n = <span class="built_in">RD</span>(), A = <span class="built_in">RD</span>(), B = <span class="built_in">RD</span>(), C[<span class="number">1</span>] = <span class="built_in">RD</span>();</span><br><span class="line">  C[<span class="number">0</span>] = <span class="number">1</span>, C[<span class="number">2</span>] = C[<span class="number">1</span>] * C[<span class="number">1</span>] % Mod;</span><br><span class="line">  a[<span class="number">0</span>] = b[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span>(B == <span class="number">1</span>) &#123;</span><br><span class="line">    ++n;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> Tri[<span class="number">50</span>], <span class="built_in">A3</span>(A);</span><br><span class="line">    Tri[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> <span class="built_in">i</span>(<span class="number">3</span>), <span class="built_in">j</span>(<span class="number">1</span>); i &lt;= n; i *= <span class="number">3</span>, ++j) &#123;</span><br><span class="line">      <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> Sec, Trd;</span><br><span class="line">      Sec = (Tri[j - <span class="number">1</span>] * A3 % Mod) * C[<span class="number">1</span>] % Mod;</span><br><span class="line">      Trd = (Sec * A3 % Mod) * C[<span class="number">1</span>] % Mod;</span><br><span class="line">      Tri[j] = (Tri[j - <span class="number">1</span>] + Sec + Trd) % Mod;</span><br><span class="line">      A3 = (A3 * A3 % Mod) * A3 % Mod;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    for (unsigned long long i(3), j(1); i &lt;= n; i *= 3, ++j)</span></span><br><span class="line"><span class="comment">//      printf(&quot;%llu &quot;, Tri[j]); putchar(0x0A);</span></span><br><span class="line">    <span class="function"><span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> <span class="title">Cur</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">unsigned</span> <span class="title">Lg</span><span class="params">(<span class="number">0</span>)</span>, <span class="title">Rm</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">    <span class="keyword">while</span> (n) &#123;</span><br><span class="line"><span class="comment">//      printf(&quot;n = %llu Cur %llu\n&quot;, n, Cur);</span></span><br><span class="line">      <span class="keyword">if</span>(Rm = ((n % (Cur * <span class="number">3</span>)) / Cur)) &#123;</span><br><span class="line"><span class="comment">//        printf(&quot;Rm = %u\n&quot;, Rm);</span></span><br><span class="line">        <span class="keyword">if</span>(Rm ^ <span class="number">1</span>) &#123;</span><br><span class="line">          <span class="function"><span class="type">unsigned</span> <span class="title">CP</span><span class="params">(PpC3(n / (Cur * <span class="number">3</span>)))</span></span>;</span><br><span class="line"><span class="comment">//          printf(&quot;CP %llu %u\n&quot;, n / (Cur * 3), CP); </span></span><br><span class="line">          Ans = (Ans + (<span class="built_in">Pow</span>(A, n - Cur) * Tri[Lg] % Mod) * <span class="built_in">Pow</span>(C[<span class="number">1</span>], CP + <span class="number">1</span>)) % Mod;</span><br><span class="line">          Ans = (Ans + (<span class="built_in">Pow</span>(A, n - (Cur &lt;&lt; <span class="number">1</span>)) * Tri[Lg] % Mod) * <span class="built_in">Pow</span>(C[<span class="number">1</span>], CP)) % Mod;</span><br><span class="line">          n -= (Cur &lt;&lt; <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> <span class="built_in">CP</span>(<span class="built_in">PpC3</span>(n / (Cur * <span class="number">3</span>)));</span><br><span class="line"><span class="comment">//          printf(&quot;CP %llu %u\n&quot;, n / (Cur * 3), CP);</span></span><br><span class="line">          Ans = (Ans + (<span class="built_in">Pow</span>(A, n - Cur) * Tri[Lg] % Mod) * <span class="built_in">Pow</span>(C[<span class="number">1</span>], CP)) % Mod;</span><br><span class="line">          n -= Cur;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      ++Lg, Cur *= <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%llu\n&quot;</span>, Ans - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">//    printf(&quot;%u\n&quot;)</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(n &lt;= <span class="number">10000000</span>) &#123;</span><br><span class="line"><span class="comment">//    Ans = 0;</span></span><br><span class="line"><span class="comment">//    printf(&quot;Excuseme %u\n&quot;, n);</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>), <span class="built_in">j</span>(<span class="number">1</span>); i &lt;= n; ++i) &#123;</span><br><span class="line">      a[i] = (<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span>)a[i &gt;&gt; <span class="number">1</span>] * ((i &amp; <span class="number">1</span>) ? B : <span class="number">1</span>) % Mod;</span><br><span class="line">      b[i] = (<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span>)b[i / <span class="number">3</span>] * C[i % <span class="number">3</span>] % Mod;</span><br><span class="line">      j = j * A % Mod;</span><br><span class="line">      Ans = (Ans + ((<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span>)j * b[i] % Mod) * a[i]) % Mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%llu\n&quot;</span>, Ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">100 1 1 2</span></span><br><span class="line"><span class="comment">10 2 1 1</span></span><br><span class="line"><span class="comment">8 2 1 2</span></span><br><span class="line"><span class="comment">9 2 1 2</span></span><br><span class="line"><span class="comment">10 2 1 2</span></span><br><span class="line"><span class="comment">100000001 123 1 12345</span></span><br><span class="line"><span class="comment">887397358</span></span><br><span class="line"><span class="comment">899868317</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>接着考虑正解, 一开始想的是既然 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">y = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> 是以 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span></span></span></span> 为底的倍增, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>z</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">z = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> 是以 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span> 为底的倍增, 那么是否可以以 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>6</mn></mrow><annotation encoding="application/x-tex">6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">6</span></span></span></span> 为底进行倍增, 无果.</p>
<h2 id="d1t3-子串统计"><a class="markdownIt-Anchor" href="#d1t3-子串统计"></a> D1T3 子串统计</h2>
<p>一开始吧 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>∏</mo></mrow><annotation encoding="application/x-tex">\prod</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.00001em;vertical-align:-0.25001em;"></span><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∏</span></span></span></span> 看成 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>∑</mo></mrow><annotation encoding="application/x-tex">\sum</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.00001em;vertical-align:-0.25001em;"></span><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span></span></span></span> 了, 导致了我以为一眼秒了, 对这个题有了一个大水题的第一印象, 所以 Day1 的大部分时间都是在 SAM 上疯狂 DP.</p>
<p>因为比赛前刚秒了几道字符串, 发现我简直是个字符串带师, 省选题又出现过那种题目难度完全和编排无关的情况, 所以我认为只要把 T3 做出来就能翻我 T1, T2 都不会的盘.</p>
<p>对于一个字串 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">[</mo><mi>l</mi><mo separator="true">,</mo><mi>r</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[l, r]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mclose">]</span></span></span></span>, 我们设它的出现次数是 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>g</mi><mrow><mi>l</mi><mo separator="true">,</mo><mi>r</mi></mrow></msub></mrow><annotation encoding="application/x-tex">g_{l, r}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>, 对答案的贡献是 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>l</mi><mo separator="true">,</mo><mi>r</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_{l, r}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>, 那么有式子:</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>l</mi><mo separator="true">,</mo><mi>r</mi></mrow></msub><mo>=</mo><msub><mi>g</mi><mrow><mi>l</mi><mo separator="true">,</mo><mi>r</mi></mrow></msub><mo stretchy="false">(</mo><msub><mi>f</mi><mrow><mi>l</mi><mo>−</mo><mn>1</mn><mo separator="true">,</mo><mi>r</mi></mrow></msub><mo>+</mo><msub><mi>f</mi><mrow><mi>l</mi><mo separator="true">,</mo><mi>r</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f_{l, r} = g_{l, r} (f_{l - 1, r} + f_{l, r + 1})
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p>
<p>可以用 SAM 求出所有的 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>g</mi></mrow><annotation encoding="application/x-tex">g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span></span></span></span>, 然后 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> 算出所有的贡献, 最后答案遍是 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle scriptlevel="0" displaystyle="true"><mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>f</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>i</mi></mrow></msub></mrow></mstyle></mrow><annotation encoding="application/x-tex">\displaystyle{\sum_{i = 1}^n f_{i, i}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.929066em;vertical-align:-1.277669em;"></span><span class="mord"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></span>, 这个做法可以得到 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn><msup><mn>5</mn><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">25&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord"><span class="mord">5</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>.</p>
<p>其实还有一个做法, 就是用 SAM 上的节点进行 DP, 我们知道每个节点对应一系列的子串, 假设 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_{i, j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> 表示节点 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> 代表的, 长度为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> 的子串所有出现位置的贡献之和. 那么我们可以把 SAM 拆成 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>n</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">n^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span> 个节点, 使得每个节点只代表一个子串, 用 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">f_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 表示每个节点的子串所有出现位置的贡献之和. 然后通过递归得到答案, 如果结合 <code>unordered_map</code> 进行记忆化搜索, 那么复杂度仍然是 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> 的, 因为每个值只会被计算一遍.</p>
<p>这个做法比正常 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> 慢不少, 感官上是过不了 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn><msup><mn>5</mn><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">25&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord"><span class="mord">5</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span> 的, 所以就是个废物, 用来验证正确性倒是可以, 但是场上这个做法相比上一种做法要麻烦很多, 所以每次两个做法答案不同都是这个做法出锅. 如果硬要给它找一个优点, 就是我们无需把所有点真的建出来, 所以可以在过大的数据中赶在 RE 或 MLE 之前 TLE.</p>
<p>下面是考场代码, 结合了上面两种做法, 期望仍为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn><msup><mn>5</mn><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">25&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord"><span class="mord">5</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bitset&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">unsigned</span> <span class="title">RD</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="type">unsigned</span> <span class="title">Rtmp</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">  <span class="function"><span class="type">char</span> <span class="title">Rch</span><span class="params">(getchar())</span></span>;</span><br><span class="line">  <span class="keyword">while</span>(Rch &lt; <span class="string">&#x27;0&#x27;</span> || Rch &gt; <span class="string">&#x27;9&#x27;</span>) Rch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span>(Rch &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; Rch &lt;= <span class="string">&#x27;9&#x27;</span>)</span><br><span class="line">    Rtmp = Rtmp * <span class="number">10</span> + Rch - <span class="string">&#x27;0&#x27;</span>, Rch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">return</span> Rtmp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">RDsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">Rtmp</span><span class="params">(<span class="number">0</span>)</span>, <span class="title">Rsig</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">  <span class="function"><span class="type">char</span> <span class="title">Rch</span><span class="params">(getchar())</span></span>;</span><br><span class="line">  <span class="keyword">while</span>((Rch &lt; <span class="string">&#x27;0&#x27;</span> || Rch &gt; <span class="string">&#x27;9&#x27;</span>) &amp;&amp; (Rch ^ <span class="string">&#x27;-&#x27;</span>)) Rch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">if</span>(Rch == <span class="string">&#x27;-&#x27;</span>) Rsig = <span class="number">-1</span>, Rch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span>(Rch &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; Rch &lt;= <span class="string">&#x27;9&#x27;</span>)</span><br><span class="line">    Rtmp = Rtmp * <span class="number">10</span> + Rch - <span class="string">&#x27;0&#x27;</span>, Rch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">return</span> Rtmp * Rsig;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">const</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> <span class="title">Mod</span><span class="params">(<span class="number">998244353</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> <span class="title">Pow</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> x, <span class="type">unsigned</span> y)</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> <span class="title">Rt</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">  <span class="keyword">while</span> (y) &#123;<span class="keyword">if</span>(y &amp; <span class="number">1</span>) Rt = Rt * x % Mod; x = x * x % Mod, y &gt;&gt;= <span class="number">1</span>;&#125;</span><br><span class="line">  <span class="keyword">return</span> Rt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">char</span> a[<span class="number">100005</span>];</span><br><span class="line"><span class="type">unsigned</span> n, m;</span><br><span class="line"><span class="type">unsigned</span> A, B, C, D, t;</span><br><span class="line"><span class="function"><span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> <span class="title">Ans</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">  unordered_map&lt;<span class="type">unsigned</span>, <span class="type">unsigned</span>&gt; Mp;</span><br><span class="line">  vector&lt;Node*&gt; Son;</span><br><span class="line">  Node* E[<span class="number">26</span>], *Link;</span><br><span class="line">  <span class="type">unsigned</span> Len, EndPos, Idg;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Add</span><span class="params">(<span class="type">char</span> c)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> <span class="title">Get</span><span class="params">(<span class="type">unsigned</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x == n) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(Mp[x]) <span class="keyword">return</span> Mp[x];</span><br><span class="line">    <span class="function"><span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> <span class="title">Bot</span><span class="params">(Pow(EndPos, Len - x))</span></span>;</span><br><span class="line">    <span class="function"><span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> <span class="title">Rt</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">0</span>); i &lt; <span class="number">26</span>; ++i) <span class="keyword">if</span>(E[i])</span><br><span class="line">      Rt = (Rt + E[i]-&gt;<span class="built_in">Get</span>(x + <span class="number">1</span>)) % Mod;</span><br><span class="line">    <span class="keyword">if</span>(Len == x) <span class="keyword">for</span> (<span class="keyword">auto</span> i:Son) Rt = (Rt + i-&gt;<span class="built_in">Get</span>(Len + <span class="number">1</span>)) % Mod;</span><br><span class="line">    <span class="keyword">else</span> Rt += <span class="built_in">Get</span>(x + <span class="number">1</span>);</span><br><span class="line"><span class="comment">//    printf(&quot;Find %u = %llu\n&quot;, x, Rt);</span></span><br><span class="line">    <span class="keyword">return</span> Mp[x] = (Rt * EndPos % Mod);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">DFS</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> i:Son) i-&gt;<span class="built_in">DFS</span>(), EndPos += i-&gt;EndPos;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;N[<span class="number">200005</span>], *List[<span class="number">100005</span>], *<span class="built_in">CntN</span>(N), *<span class="built_in">Last</span>(N);</span><br><span class="line">Node *Que[<span class="number">200005</span>], **<span class="built_in">Hd</span>(Que), **<span class="built_in">Tl</span>(Que);</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Node::Add</span><span class="params">(<span class="type">char</span> c)</span> </span>&#123;</span><br><span class="line">  Len = Last-&gt;Len + <span class="number">1</span>;</span><br><span class="line">  <span class="function">Node* <span class="title">Back</span><span class="params">(Last)</span></span>;</span><br><span class="line">  <span class="keyword">while</span> (Back &amp;&amp; (!Back-&gt;E[c])) Back-&gt;E[c] = <span class="keyword">this</span>, Back = Back-&gt;Link;</span><br><span class="line">  <span class="keyword">if</span>(!Back) &#123;Link = N, Last = <span class="keyword">this</span>; <span class="keyword">return</span>;&#125;</span><br><span class="line">  <span class="keyword">if</span>(Back-&gt;E[c]-&gt;Len == Back-&gt;Len + <span class="number">1</span>) &#123;</span><br><span class="line">    Link = Back-&gt;E[c], Last = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function">Node *<span class="title">Ori</span><span class="params">(Back-&gt;E[c])</span>, *<span class="title">Copy</span><span class="params">(++CntN)</span></span>;</span><br><span class="line">  *Copy = *Ori, Copy-&gt;Len = Back-&gt;Len + <span class="number">1</span>;</span><br><span class="line">  Ori-&gt;Link = Link = Copy, Last = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">while</span> (Back &amp;&amp; (Back-&gt;E[c] == Ori))</span><br><span class="line">    Back-&gt;E[c] = Copy, Back = Back-&gt;Link;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">freopen</span>(<span class="string">&quot;substring.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin);</span><br><span class="line"><span class="comment">//  freopen(&quot;ex_substring3.in&quot;, &quot;r&quot;, stdin);</span></span><br><span class="line">  <span class="built_in">freopen</span>(<span class="string">&quot;substring.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, a + <span class="number">1</span>);</span><br><span class="line">  n = <span class="built_in">strlen</span>(a + <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt;= n; ++i) (List[i] = ++CntN)-&gt;<span class="built_in">Add</span>(a[i] - <span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt;= n; ++i) List[i]-&gt;EndPos = <span class="number">1</span>;</span><br><span class="line"><span class="comment">//  printf(&quot;Link:&quot;);for (Node *i(N + 1); i &lt;= CntN; ++i) printf(&quot;%u &quot;, i-&gt;Link - N); putchar(0x0A);</span></span><br><span class="line">  <span class="keyword">for</span> (Node *<span class="built_in">i</span>(N + <span class="number">1</span>); i &lt;= CntN; ++i) i-&gt;Link-&gt;Son.<span class="built_in">push_back</span>(i), ++(i-&gt;Idg);</span><br><span class="line">  N-&gt;<span class="built_in">DFS</span>();</span><br><span class="line"><span class="comment">//  printf(&quot;EndPos:&quot;);for (Node *i(N + 1); i &lt;= CntN; ++i) printf(&quot;%u &quot;, i-&gt;EndPos); putchar(0x0A);</span></span><br><span class="line">  <span class="keyword">if</span>(n &lt;= <span class="number">5000</span>) &#123;</span><br><span class="line">    <span class="type">unsigned</span> Apr[<span class="number">5005</span>][<span class="number">5005</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>), <span class="built_in">j</span>(<span class="number">1</span>); i &lt;= n; j = ++i) &#123;</span><br><span class="line">      <span class="function">Node* <span class="title">Cur</span><span class="params">(List[i])</span></span>;</span><br><span class="line">      <span class="keyword">while</span> (Cur) &#123;</span><br><span class="line"><span class="comment">//        printf(&quot;i %u Cur %u j %u\n&quot;, i, Cur - N, j);</span></span><br><span class="line">        <span class="function"><span class="type">unsigned</span> <span class="title">LenMin</span><span class="params">(Cur-&gt;Link ? (Cur-&gt;Link-&gt;Len + <span class="number">1</span>) : <span class="number">1</span>)</span></span>;</span><br><span class="line">        <span class="keyword">while</span> (j &gt;= LenMin) Apr[j][i - j + <span class="number">1</span>] = Cur-&gt;EndPos, --j;</span><br><span class="line">        Cur = Cur-&gt;Link;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    for (unsigned i(n); i; --i) &#123;</span></span><br><span class="line"><span class="comment">//      for (unsigned j(n - i + 1); j; --j) printf(&quot;%3u&quot;, Apr[i][j]); putchar(0x0A);</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(n - <span class="number">1</span>); i; --i) <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">j</span>(n - i + <span class="number">1</span>); j; --j)</span><br><span class="line">      Apr[i][j] = (<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span>)Apr[i][j] * (Apr[i + <span class="number">1</span>][j] + Apr[i + <span class="number">1</span>][j - <span class="number">1</span>]) % Mod;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">j</span>(<span class="number">1</span>); j &lt;= n; ++j) Ans += Apr[<span class="number">1</span>][j];</span><br><span class="line"><span class="comment">//    for (unsigned i(n); i; --i) &#123;</span></span><br><span class="line"><span class="comment">//      for (unsigned j(n - i + 1); j; --j) printf(&quot;%3u&quot;, Apr[i][j]); putchar(0x0A);</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%llu\n&quot;</span>, Ans % Mod);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  Ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (Node *<span class="built_in">i</span>(N); i &lt;= CntN; ++i)</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">char</span> <span class="built_in">j</span>(<span class="number">0</span>); j &lt; <span class="number">26</span>; ++j) <span class="keyword">if</span>(i-&gt;E[j]) ++(i-&gt;E[j]-&gt;Idg);</span><br><span class="line">    *(++Tl) = N;</span><br><span class="line">    <span class="keyword">while</span> (Hd &lt; Tl) &#123;</span><br><span class="line">      <span class="function">Node* <span class="title">Cur</span><span class="params">(*(++Hd))</span></span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">auto</span> i:Cur-&gt;Son) <span class="keyword">if</span>(!(--(i-&gt;Idg))) *(++Tl) = i;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">char</span> <span class="built_in">i</span>(<span class="number">0</span>); i &lt; <span class="number">26</span>; ++i) <span class="keyword">if</span>(Cur-&gt;E[i])</span><br><span class="line">        <span class="keyword">if</span>(!(--(Cur-&gt;E[i]-&gt;Idg))) *(++Tl) = Cur-&gt;E[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*for (unsigned i(1), j(1); i &lt;= n; j = ++i) &#123;</span></span><br><span class="line"><span class="comment">      Node* Cur(List[i]);</span></span><br><span class="line"><span class="comment">      while (Cur) &#123;</span></span><br><span class="line"><span class="comment">  //    printf(&quot;i %u Cur %u j %u\n&quot;, i, Cur - N, j);</span></span><br><span class="line"><span class="comment">        unsigned LenMin(Cur-&gt;Link ? (Cur-&gt;Link-&gt;Len + 1) : 1);</span></span><br><span class="line"><span class="comment">        while (j &gt;= LenMin) printf(&quot;%llu &quot;, Cur-&gt;Get(j--));</span></span><br><span class="line"><span class="comment">        Cur = Cur-&gt;Link;</span></span><br><span class="line"><span class="comment">      &#125;</span></span><br><span class="line"><span class="comment">      putchar(0x0A);</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line"><span class="comment">//    for (unsigned i(1); i &lt;= n; ++i) printf(&quot;%llu &quot;, List[i]-&gt;Val); putchar(0x0A);</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">char</span> <span class="built_in">j</span>(<span class="number">0</span>); j &lt; <span class="number">26</span>; ++j) <span class="keyword">if</span>(N-&gt;E[j]) Ans += N-&gt;E[j]-&gt;<span class="built_in">Get</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%llu\n&quot;</span>, Ans % Mod), Ans = <span class="number">0</span>;  </span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<p>当时有好多人切了 T1, 而我发现这道题非常的简单, 我甚至在两三天之前做了一道根号分治 (三元环计数模板), 但是我中途往动态开点线段树那里想了, 所以越想越觉得不可做.</p>
<p>接下来我表示如果下午但凡有个字符串或者数数, 我都能翻, 因为我是字符串大师 + 计数天才. 这个说法是相对的, 因为我对各种自动机的理解比较透彻, 并且在计数方面没有下很大功夫, 但是可以比本校的人在这方面强一些.</p>
<hr />
<h2 id="d2t1-小-n-的独立集"><a class="markdownIt-Anchor" href="#d2t1-小-n-的独立集"></a> D2T1 小 N 的独立集</h2>
<p>好歹是 A 了一道题, 这是继 CSP2021 T2, NOIP2021 T2 之后, 我场上 AC 的又一道数数题. (貌似这个题被认为是 SDOI2022 最简单的一道题)</p>
<p>出场后问了别人才发现, 其实很多人不知道树形背包的复杂度其实是 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mi>V</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(nV)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mclose">)</span></span></span></span> 的. 所以好多人都不敢去写这个正解.</p>
<p>我和别人有一点不同, 就是我做题的时候大部分时间答案都是错误的, 当我可以保证正确性的时候, 我就已经把这道题做到 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>10</mn><msup><mn>0</mn><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">100&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span> 了, 而很多 AC 本题的选手则是一开始保证正确性, 不断优化得到了正解.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bitset&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">unsigned</span> <span class="title">RD</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="type">unsigned</span> <span class="title">Rtmp</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">  <span class="function"><span class="type">char</span> <span class="title">Rch</span><span class="params">(getchar())</span></span>;</span><br><span class="line">  <span class="keyword">while</span>(Rch &lt; <span class="string">&#x27;0&#x27;</span> || Rch &gt; <span class="string">&#x27;9&#x27;</span>) Rch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span>(Rch &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; Rch &lt;= <span class="string">&#x27;9&#x27;</span>)</span><br><span class="line">    Rtmp = Rtmp * <span class="number">10</span> + Rch - <span class="string">&#x27;0&#x27;</span>, Rch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">return</span> Rtmp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">RDsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">Rtmp</span><span class="params">(<span class="number">0</span>)</span>, <span class="title">Rsig</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">  <span class="function"><span class="type">char</span> <span class="title">Rch</span><span class="params">(getchar())</span></span>;</span><br><span class="line">  <span class="keyword">while</span>((Rch &lt; <span class="string">&#x27;0&#x27;</span> || Rch &gt; <span class="string">&#x27;9&#x27;</span>) &amp;&amp; (Rch ^ <span class="string">&#x27;-&#x27;</span>)) Rch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">if</span>(Rch == <span class="string">&#x27;-&#x27;</span>) Rsig = <span class="number">-1</span>, Rch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span>(Rch &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; Rch &lt;= <span class="string">&#x27;9&#x27;</span>)</span><br><span class="line">    Rtmp = Rtmp * <span class="number">10</span> + Rch - <span class="string">&#x27;0&#x27;</span>, Rch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">return</span> Rtmp * Rsig;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">const</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> <span class="title">Mod</span><span class="params">(<span class="number">1000000007</span>)</span></span>;</span><br><span class="line"><span class="type">unsigned</span> n, m;</span><br><span class="line"><span class="type">unsigned</span> A, B, C, D, t;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">  vector&lt;Node*&gt; E;</span><br><span class="line">  <span class="type">unsigned</span> f[<span class="number">5005</span>][<span class="number">6</span>], Size;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">DFS</span><span class="params">(Node* Fa)</span> </span>&#123;</span><br><span class="line">    Size = m;</span><br><span class="line">    <span class="keyword">if</span>((E.<span class="built_in">size</span>() == <span class="number">1</span>) &amp;&amp; Fa) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt;= m; ++i) f[<span class="number">0</span>][i] = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> i:E) <span class="keyword">if</span>(i != Fa) i-&gt;<span class="built_in">DFS</span>(<span class="keyword">this</span>), Size += i-&gt;Size;</span><br><span class="line">    <span class="type">unsigned</span> Tmp[Size + <span class="number">5</span>][<span class="number">6</span>], NoRoot[Size + <span class="number">5</span>], TNoR[Size + <span class="number">5</span>], <span class="built_in">Bot</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="function"><span class="type">unsigned</span> <span class="title">MeL</span><span class="params">((Size + <span class="number">5</span>) &lt;&lt; <span class="number">2</span>)</span>, <span class="title">MeB</span><span class="params">(MeL * <span class="number">6</span>)</span>, <span class="title">Cur</span><span class="params">(m)</span></span>;</span><br><span class="line">    <span class="built_in">memset</span>(NoRoot, <span class="number">0</span>, MeL);</span><br><span class="line">    <span class="keyword">while</span> (E[Bot] == Fa) ++Bot;</span><br><span class="line">    <span class="built_in">memcpy</span>(f, E[Bot]-&gt;f, MeB), Cur += E[Bot]-&gt;Size;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="built_in">I</span>(E.<span class="built_in">size</span>() - <span class="number">1</span>); I &gt; Bot; --I) <span class="keyword">if</span>(E[I] != Fa) &#123;</span><br><span class="line">      <span class="function">Node* <span class="title">i</span><span class="params">(E[I])</span></span>;</span><br><span class="line">      <span class="built_in">memcpy</span>(Tmp, f, MeB), <span class="built_in">memset</span>(f, <span class="number">0</span>, MeB);</span><br><span class="line">      <span class="built_in">memcpy</span>(TNoR, NoRoot, MeL), <span class="built_in">memset</span>(NoRoot, <span class="number">0</span>, MeL);</span><br><span class="line">      <span class="type">unsigned</span> *TTo, Mx, SMx;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">My</span>(Cur); ~My; --My)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">Son</span>(i-&gt;Size); ~Son; --Son) &#123;</span><br><span class="line">          <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">k</span>(m); ~k; --k)</span><br><span class="line">            NoRoot[My + Son + k] = (NoRoot[My + Son + k] + (<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span>)TNoR[My] * i-&gt;f[Son][k]) % Mod;</span><br><span class="line">          <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">j</span>(<span class="number">0</span>); j &lt;= m; ++j) <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">k</span>(<span class="number">0</span>); k &lt;= m; ++k) &#123;</span><br><span class="line">            <span class="keyword">if</span>(j + k &gt;= m) TTo = NoRoot + My + Son + j + k;</span><br><span class="line">            <span class="keyword">else</span> TTo = f[My + Son] + j + k;</span><br><span class="line">            *TTo = (*TTo + (<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span>)Tmp[My][j] * i-&gt;f[Son][k]) % Mod;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      Cur += i-&gt;Size;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">memcpy</span>(Tmp, f, MeB);</span><br><span class="line">    <span class="built_in">memset</span>(f, <span class="number">0</span>, MeB);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(Size); ~i; --i) &#123;</span><br><span class="line">      f[i][<span class="number">0</span>] = NoRoot[i] * (<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span>)m % Mod;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">j</span>(<span class="number">0</span>); j &lt;= m; ++j) &#123;</span><br><span class="line">        f[i + j][<span class="number">0</span>] = (f[i + j][<span class="number">0</span>] + (<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span>)j * Tmp[i][j]) % Mod;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">k</span>(j + <span class="number">1</span>); k &lt;= m; ++k)</span><br><span class="line">          f[i + j][k - j] = (f[i + j][k - j] + Tmp[i][j]) % Mod;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">char</span> <span class="title">Flg</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">unsigned</span> <span class="title">Ori</span><span class="params">(Size)</span></span>;</span><br><span class="line"><span class="comment">//    printf(&quot;Ori = %u\n&quot;, Size);</span></span><br><span class="line">    <span class="keyword">while</span> (!Flg) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">0</span>); i &lt;= m; ++i) <span class="keyword">if</span>(f[Size][i]) &#123;Flg = <span class="number">1</span>; <span class="keyword">break</span>;&#125;</span><br><span class="line">      <span class="keyword">if</span>(!Flg) &#123;</span><br><span class="line"><span class="comment">//        for (unsigned i(0); i &lt;= m; ++i) printf(&quot;%u &quot;, f[Size][i]); putchar(0x0A);</span></span><br><span class="line">        --Size;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Size += <span class="number">5</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;N[<span class="number">1005</span>];</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">freopen</span>(<span class="string">&quot;nset.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin);</span><br><span class="line"><span class="comment">//  freopen(&quot;ex_nset2.in&quot;, &quot;r&quot;, stdin);</span></span><br><span class="line">  <span class="built_in">freopen</span>(<span class="string">&quot;nset.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout);</span><br><span class="line">  n = <span class="built_in">RD</span>(), m = <span class="built_in">RD</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt; n; ++i) &#123;</span><br><span class="line">    A = <span class="built_in">RD</span>(), B = <span class="built_in">RD</span>();</span><br><span class="line">    N[A].E.<span class="built_in">push_back</span>(N + B);</span><br><span class="line">    N[B].E.<span class="built_in">push_back</span>(N + A);</span><br><span class="line">  &#125;</span><br><span class="line">  N[<span class="number">1</span>].<span class="built_in">DFS</span>(<span class="literal">NULL</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt;= n * m; ++i) &#123;</span><br><span class="line">    <span class="function"><span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> <span class="title">Ans</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">j</span>(<span class="built_in">min</span>(m, i)); ~j; --j) Ans += (i - j &gt; N[<span class="number">1</span>].Size) ? <span class="number">0</span> : N[<span class="number">1</span>].f[i - j][j];</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%llu\n&quot;</span>, Ans % Mod);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这道题的心路历程是一开始没有保证状态为最大独立集, 而是把它当成一个求最大独立集的问题. 因为早就知道一般图最大独立集是个 NP Hard, 但是做题过程中发现树的最大独立集貌似可以求, 于是就想到了一个类似求最大独立集的 DP, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo separator="true">,</mo><mn>0</mn><mi mathvariant="normal">/</mi><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">f_{i, j, 0/1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.04964em;vertical-align:-0.3551999999999999em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.34480000000000005em;"><span style="top:-2.5198em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mpunct mtight">,</span><span class="mord mtight">0</span><span class="mord mtight">/</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3551999999999999em;"><span></span></span></span></span></span></span></span></span></span> 表示一个点 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> 的子树中, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> 选/不选的最大独立集为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> 的方案数, 手玩发现显然是错误的, 因为它不能转移, 转移则无法保证 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> 确实是某个方案的最大独立集 (当时是这样认为的, 其实事后发现并没有这么简单, 反正显然是错误的就是了).</p>
<p>接下来我又开始往别的方向去思考, 就是设 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo separator="true">,</mo><mi>k</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_{i, j, k}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> 表示 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> 选 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> 的情况下 (<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">k = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> 则不选), <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> 的子树的最大独立集为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> 的情况, 这显然更加扯淡, 不一会手玩失败的我就放弃了想法.</p>
<p>其实场上我并没有搞懂为什么我最终的方程是正确的, 但是后来暴力哥的做法却给我指明了一条路: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo separator="true">,</mo><mi>k</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_{i, j, k}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> 表示 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> 的子树内, 最大独立集为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> 强制不选的最大独立集为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span>. 这样保存了两个值, 而我前面的做法只保留了一个有效的值, 第三维的值显然是对转移没有任何作用的. 这两个值就包括了 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> 的子树的权值分配方案在任何状态中的两种选择最大独立集的方案, 因为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> 的父亲也就无非两种情况, 选或者不选, 如果它的父亲被某个方案中的最大独立集包含, 那么 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> 就强制不选, 否则 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> 没有限制, 可以直接按 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> 子树内的最大独立集来选.</p>
<p>而我当时考虑的也和这个过程差不多, 但是我没有想维护两个最大独立集, 我同样也是分析了这两种情况, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> 受限制和不受限制, 首先因为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> 不受限制的合法的独立集完全包含了 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> 受限制的合法的独立集, 所以 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> 不受限的最大独立集一定不小于 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> 受限的最大独立集. 又因为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> 受限的最大独立集和 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> 不受限的最大独立集的差值如果大于 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>5</mn></mrow><annotation encoding="application/x-tex">5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">5</span></span></span></span>, 那么我们完全可以从 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> 不受限的最大独立集中删除 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span>, 得到一个合法的, 比原有方案更优的方案, 因此两者最大独立集的差不超过点权的上限. 所以我们记录一个 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> 表示受限的最大独立集, 然后 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> 表示如果我们给 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> 自由, 它可以给我们带来多少好处, 也就是 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> 不受限会让最大独立集增加多少, 这个值不超过 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>5</mn></mrow><annotation encoding="application/x-tex">5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">5</span></span></span></span>.</p>
<p>然后就把这道题做出来了. 树上背包的复杂度是 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>, 这是老祖宗给我们留下来的精神瑰宝, 好多人因为不知道这个而不敢写, 痛失 AC.</p>
<h2 id="d2t2-无处存储"><a class="markdownIt-Anchor" href="#d2t2-无处存储"></a> D2T2 无处存储</h2>
<p>刮痧题. 场上大部分选手们都刮了 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn><msup><mn>0</mn><mo mathvariant="normal">′</mo></msup><mtext> </mtext><mn>5</mn><msup><mn>0</mn><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">20&#x27;~50&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mord">5</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>, 只有我只刮了 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><msup><mn>0</mn><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">10&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>, 可能是因为 DFS 原因, MLE 导致只拿到了 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">2&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>.</p>
<p>这两分就是只有 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>3000</mn></mrow><annotation encoding="application/x-tex">3000</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span></span></span></span> 的那个点, 考场代码是这样的, 写了 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>6</mn></msup></mrow><annotation encoding="application/x-tex">2\times 10^6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span></span></span></span></span></span></span></span> 的单点修改, 单点查询但是没有过:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bitset&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Lbt(x) (((~(x))+1)&amp;(x))</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">unsigned</span> <span class="title">RD</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="type">unsigned</span> <span class="title">Rtmp</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">  <span class="function"><span class="type">char</span> <span class="title">Rch</span><span class="params">(getchar())</span></span>;</span><br><span class="line">  <span class="keyword">while</span>(Rch &lt; <span class="string">&#x27;0&#x27;</span> || Rch &gt; <span class="string">&#x27;9&#x27;</span>) Rch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span>(Rch &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; Rch &lt;= <span class="string">&#x27;9&#x27;</span>)</span><br><span class="line">    Rtmp = Rtmp * <span class="number">10</span> + Rch - <span class="string">&#x27;0&#x27;</span>, Rch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">return</span> Rtmp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">RDsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">Rtmp</span><span class="params">(<span class="number">0</span>)</span>, <span class="title">Rsig</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">  <span class="function"><span class="type">char</span> <span class="title">Rch</span><span class="params">(getchar())</span></span>;</span><br><span class="line">  <span class="keyword">while</span>((Rch &lt; <span class="string">&#x27;0&#x27;</span> || Rch &gt; <span class="string">&#x27;9&#x27;</span>) &amp;&amp; (Rch ^ <span class="string">&#x27;-&#x27;</span>)) Rch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">if</span>(Rch == <span class="string">&#x27;-&#x27;</span>) Rsig = <span class="number">-1</span>, Rch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span>(Rch &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; Rch &lt;= <span class="string">&#x27;9&#x27;</span>)</span><br><span class="line">    Rtmp = Rtmp * <span class="number">10</span> + Rch - <span class="string">&#x27;0&#x27;</span>, Rch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">return</span> Rtmp * Rsig;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">unsigned</span> n, m;</span><br><span class="line"><span class="type">unsigned</span> A, B, C, D, <span class="built_in">Tmp</span>(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="type">unsigned</span> <span class="title">Ans</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">unsigned</span> <span class="title">CalcV</span><span class="params">(<span class="type">unsigned</span> x)</span> </span>&#123;<span class="keyword">return</span> x * (A * x + B) + C;&#125;</span><br><span class="line"><span class="type">unsigned</span> Pre[<span class="number">1000005</span>], Heavy[<span class="number">1000005</span>], <span class="built_in">Cnt</span>(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Ins</span> <span class="params">(<span class="type">unsigned</span> x, <span class="type">unsigned</span> y)</span> </span>&#123;<span class="keyword">while</span> (x &lt;= n) Pre[x] += y, x += <span class="built_in">Lbt</span>(x);&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Qry</span> <span class="params">(<span class="type">unsigned</span> x)</span> </span>&#123;Tmp = <span class="number">0</span>; <span class="keyword">while</span> (x) Tmp += Pre[x], x -= <span class="built_in">Lbt</span>(x);&#125;</span><br><span class="line"><span class="function"><span class="type">char</span> <span class="title">FlgZ</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">  vector&lt;<span class="type">unsigned</span>&gt; Son;</span><br><span class="line">  <span class="type">unsigned</span> Fa, DFSr, Dep, Top;</span><br><span class="line">&#125;N[<span class="number">1000005</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">unsigned</span> <span class="title">DFS</span><span class="params">(<span class="type">unsigned</span> x)</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="type">unsigned</span> <span class="title">Size</span><span class="params">(<span class="number">1</span>)</span>, <span class="title">CS</span><span class="params">(<span class="number">0</span>)</span>, <span class="title">TS</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> i:N[x].Son) &#123;</span><br><span class="line">    N[i].Dep = N[x].Dep + <span class="number">1</span>, Size += (CS = <span class="built_in">DFS</span>(i));</span><br><span class="line">    <span class="keyword">if</span>(TS &lt; CS) TS = CS, Heavy[x] = i;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> Size;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">DFS2</span><span class="params">(<span class="type">unsigned</span> x)</span> </span>&#123;</span><br><span class="line">  N[x].DFSr = ++Cnt;</span><br><span class="line">  <span class="keyword">if</span>(Heavy[x]) N[Heavy[x]].Top = N[x].Top, <span class="built_in">DFS2</span>(Heavy[x]);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> i:N[x].Son) <span class="keyword">if</span>(i != Heavy[x])N[i].Top = i, <span class="built_in">DFS2</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">freopen</span>(<span class="string">&quot;problemprovidercreep.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin);</span><br><span class="line"><span class="comment">//  freopen(&quot;12.in&quot;, &quot;r&quot;, stdin);</span></span><br><span class="line">  <span class="built_in">freopen</span>(<span class="string">&quot;problemprovidercreep.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout);</span><br><span class="line">  A = <span class="built_in">RD</span>();</span><br><span class="line">  <span class="keyword">if</span>(A == <span class="number">31</span>) FlgZ = <span class="number">1</span>;</span><br><span class="line">  n = <span class="built_in">RD</span>(), m = <span class="built_in">RD</span>(), A = <span class="built_in">RD</span>(), B = <span class="built_in">RD</span>(), C = <span class="built_in">RD</span>(), Heavy[<span class="number">0</span>] = <span class="built_in">RD</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">2</span>); i &lt;= n; ++i) N[N[i].Fa = <span class="built_in">RD</span>()].Son.<span class="built_in">push_back</span>(i);</span><br><span class="line">  N[<span class="number">1</span>].Dep = <span class="number">1</span>, <span class="built_in">DFS</span>(<span class="number">1</span>), <span class="built_in">DFS2</span>(<span class="number">1</span>);</span><br><span class="line"><span class="comment">//  for (unsigned i(1); i &lt;= n; ++i) printf(&quot;%u &quot;, N[i].DFSr); putchar(0x0A);</span></span><br><span class="line">  <span class="keyword">if</span>(FlgZ) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt;= n; ++i) Heavy[N[i].DFSr] = <span class="built_in">CalcV</span>(Heavy[N[i - <span class="number">1</span>].DFSr]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(n); i &gt;= <span class="number">2</span>; --i) Heavy[i] -= Heavy[i - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt;= n; ++i) <span class="built_in">Ins</span>(i, Heavy[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt;= n; ++i) Heavy[i] = <span class="built_in">CalcV</span>(Heavy[i - <span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt;= n; ++i) <span class="built_in">Ins</span>(N[i].DFSr, Heavy[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(FlgZ) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt;= m; ++i) &#123;</span><br><span class="line">      Ans &amp;= ((<span class="number">1</span> &lt;&lt; <span class="number">20</span>) - <span class="number">1</span>);</span><br><span class="line">      A = <span class="built_in">RD</span>(), B = (<span class="built_in">RD</span>() ^ Ans), C = (<span class="built_in">RD</span>() ^ Ans);</span><br><span class="line">      <span class="keyword">if</span>(A) &#123;</span><br><span class="line">        Ans = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">Qry</span>(N[B].DFSr), Ans += Tmp;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%u\n&quot;</span>, Ans);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        D = (<span class="built_in">RD</span>() ^ Ans);</span><br><span class="line">        <span class="keyword">while</span> (B &amp;&amp; C &amp;&amp; (N[B].Top ^ N[C].Top)) &#123;</span><br><span class="line">          <span class="keyword">if</span>(N[N[B].Top].Dep &lt; N[N[C].Top].Dep) <span class="built_in">swap</span>(B, C);</span><br><span class="line">          <span class="built_in">Ins</span>(N[B].DFSr + <span class="number">1</span>, -D);</span><br><span class="line">          <span class="built_in">Ins</span>(N[N[B].Top].DFSr, D);</span><br><span class="line">          B = N[N[B].Top].Fa;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(N[B].Dep &lt; N[C].Dep) <span class="built_in">swap</span>(B, C);</span><br><span class="line">        <span class="built_in">Ins</span>(N[B].DFSr + <span class="number">1</span>, -D);</span><br><span class="line">        <span class="built_in">Ins</span>(N[C].DFSr, D);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//  for (unsigned i(1); i &lt;= n; ++i) printf(&quot;%u &quot;, Heavy[i]); putchar(0x0A);</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt;= m; ++i) &#123;</span><br><span class="line"><span class="comment">//    printf(&quot;Done %u\n&quot;, i);</span></span><br><span class="line">    Ans &amp;= ((<span class="number">1</span> &lt;&lt; <span class="number">20</span>) - <span class="number">1</span>);</span><br><span class="line">    A = <span class="built_in">RD</span>(), B = (<span class="built_in">RD</span>() ^ Ans), C = (<span class="built_in">RD</span>() ^ Ans);</span><br><span class="line"><span class="comment">//    printf(&quot;%u To %u\n&quot;, B, C);</span></span><br><span class="line">    <span class="keyword">if</span>(A) &#123;</span><br><span class="line">      Ans = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">while</span> (B &amp;&amp; C &amp;&amp; (N[B].Top ^ N[C].Top)) &#123;</span><br><span class="line">        <span class="keyword">if</span>(N[N[B].Top].Dep &lt; N[N[C].Top].Dep) <span class="built_in">swap</span>(B, C);</span><br><span class="line">        <span class="built_in">Qry</span>(N[B].DFSr), Ans += Tmp;</span><br><span class="line">        <span class="built_in">Qry</span>(N[N[B].Top].DFSr - <span class="number">1</span>), Ans -= Tmp;</span><br><span class="line">        B = N[N[B].Top].Fa;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="comment">//      printf(&quot;Jumped %u %u\n&quot;, B, C);</span></span><br><span class="line">      <span class="keyword">if</span>(N[B].Dep &lt; N[C].Dep) <span class="built_in">swap</span>(B, C);</span><br><span class="line">      <span class="built_in">Qry</span>(N[B].DFSr), Ans += Tmp;</span><br><span class="line">      <span class="built_in">Qry</span>(N[C].DFSr - <span class="number">1</span>), Ans -= Tmp;</span><br><span class="line"><span class="comment">//      printf(&quot;Tmp %u\n&quot;, Tmp);</span></span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%u\n&quot;</span>, Ans);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      D = (<span class="built_in">RD</span>() ^ Ans);</span><br><span class="line">      <span class="keyword">if</span>(N[B].Dep &lt; N[C].Dep) <span class="built_in">swap</span>(B, C);</span><br><span class="line">      <span class="keyword">while</span> (N[B].Dep &gt; N[C].Dep) <span class="built_in">Ins</span>(N[B].DFSr, D), B = N[B].Fa;</span><br><span class="line">      <span class="keyword">while</span> (B ^ C)</span><br><span class="line">        <span class="built_in">Ins</span>(N[B].DFSr, D), <span class="built_in">Ins</span>(N[C].DFSr, D), B = N[B].Fa, C = N[C].Fa;</span><br><span class="line">      <span class="built_in">Ins</span>(N[C].DFSr, D);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="d2t3-多边形"><a class="markdownIt-Anchor" href="#d2t3-多边形"></a> D2T3 多边形</h2>
<p>其实当时写完 T1 先来干的是 T3, 写出了一个 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>3</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n^3)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> 的区间 DP, Hack 掉, 改 DP, 再 Hack. 其实问题的核心就是没法很好地断环为链, 所以心想再耗也不一定有结果, 不如去刮 T2.</p>
<p>所以这个题就摆烂了, 交了一个狗屁不通的代码上去:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bitset&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">unsigned</span> <span class="title">RD</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="type">unsigned</span> <span class="title">Rtmp</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">  <span class="function"><span class="type">char</span> <span class="title">Rch</span><span class="params">(getchar())</span></span>;</span><br><span class="line">  <span class="keyword">while</span>(Rch &lt; <span class="string">&#x27;0&#x27;</span> || Rch &gt; <span class="string">&#x27;9&#x27;</span>) Rch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span>(Rch &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; Rch &lt;= <span class="string">&#x27;9&#x27;</span>)</span><br><span class="line">    Rtmp = Rtmp * <span class="number">10</span> + Rch - <span class="string">&#x27;0&#x27;</span>, Rch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">return</span> Rtmp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">RDsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">Rtmp</span><span class="params">(<span class="number">0</span>)</span>, <span class="title">Rsig</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">  <span class="function"><span class="type">char</span> <span class="title">Rch</span><span class="params">(getchar())</span></span>;</span><br><span class="line">  <span class="keyword">while</span>((Rch &lt; <span class="string">&#x27;0&#x27;</span> || Rch &gt; <span class="string">&#x27;9&#x27;</span>) &amp;&amp; (Rch ^ <span class="string">&#x27;-&#x27;</span>)) Rch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">if</span>(Rch == <span class="string">&#x27;-&#x27;</span>) Rsig = <span class="number">-1</span>, Rch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span>(Rch &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; Rch &lt;= <span class="string">&#x27;9&#x27;</span>)</span><br><span class="line">    Rtmp = Rtmp * <span class="number">10</span> + Rch - <span class="string">&#x27;0&#x27;</span>, Rch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">return</span> Rtmp * Rsig;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">const</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> <span class="title">Mod</span><span class="params">(<span class="number">998244353</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Mn</span><span class="params">(<span class="type">unsigned</span> &amp;x)</span> </span>&#123; x -= (x &gt;= Mod) ? Mod : <span class="number">0</span>;&#125;</span><br><span class="line"><span class="type">unsigned</span> f[<span class="number">5005</span>][<span class="number">5005</span>], a[<span class="number">500005</span>];</span><br><span class="line"><span class="type">unsigned</span> n, m, Nom;</span><br><span class="line"><span class="type">unsigned</span> A, B, C, D, t;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">freopen</span>(<span class="string">&quot;polygon.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin);</span><br><span class="line"><span class="comment">//  freopen(&quot;polygon1.in&quot;, &quot;r&quot;, stdin);</span></span><br><span class="line">  <span class="built_in">freopen</span>(<span class="string">&quot;polygon.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout);</span><br><span class="line">  n = <span class="built_in">RD</span>(), a[m = <span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">1</span>); i &lt;= n; ++i) &#123;a[m += <span class="built_in">RD</span>()] = <span class="number">1</span>;<span class="keyword">if</span>(!Nom) Nom = m;&#125; --m;</span><br><span class="line"><span class="comment">//  for (unsigned i(1); i &lt;= m; ++i) printf(&quot;%u &quot;, a[i]); putchar(0x0A);</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(m - <span class="number">2</span>); i; --i) &#123;</span><br><span class="line">    <span class="function"><span class="type">unsigned</span> <span class="title">j</span><span class="params">(i + <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">while</span> (!a[j]) ++j; ++j;</span><br><span class="line">    <span class="keyword">if</span>(j &gt; m) <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">do</span> f[j - i][i] = <span class="number">1</span>; <span class="keyword">while</span> (!a[j++]);</span><br><span class="line"><span class="comment">//    printf(&quot;Done %u\n&quot;, i);</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//  for (unsigned i(2); i &lt; m; ++i) &#123;</span></span><br><span class="line"><span class="comment">//    for (unsigned j(1); j + i &lt;= m; ++j) printf(&quot;%3u&quot;, f[i][j]); putchar(0x0A);</span></span><br><span class="line"><span class="comment">//  &#125;</span></span><br><span class="line"><span class="comment">//  printf(&quot;Done\n&quot;);</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">i</span>(<span class="number">2</span>); i &lt;= m - <span class="number">2</span>; ++i) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="built_in">j</span>(m - i); j; --j) &#123;</span><br><span class="line">      <span class="keyword">if</span>(j + i &lt; m) &#123;</span><br><span class="line">        <span class="function"><span class="type">unsigned</span> <span class="title">k</span><span class="params">(j + i + <span class="number">1</span>)</span></span>;</span><br><span class="line">        <span class="function"><span class="keyword">do</span> <span class="title">Mn</span><span class="params">(f[k - j][j] += f[i][j])</span></span>; <span class="keyword">while</span> (!a[k++]);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(j &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="function"><span class="type">unsigned</span> <span class="title">l</span><span class="params">(j - <span class="number">1</span>)</span></span>;</span><br><span class="line">        <span class="function"><span class="keyword">do</span> <span class="title">Mn</span><span class="params">(f[i + j - l][l] += f[i][j])</span></span>; <span class="keyword">while</span> (!a[l--]);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//  for (unsigned i(2); i &lt; m; ++i) &#123;</span></span><br><span class="line"><span class="comment">//    for (unsigned j(1); j + i &lt;= m; ++j) printf(&quot;%3u&quot;, f[i][j]); putchar(0x0A);</span></span><br><span class="line"><span class="comment">//  &#125;</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%u\n&quot;</span>, f[m - <span class="number">1</span>][<span class="number">1</span>]);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
                        </div>

                        <!-- Post Comments -->
                        
    <!-- 使用 DISQUS_CLICK -->
<div id="disqus-comment">
    <div id="disqus_thread"></div>

<!-- add animation -->
<style>
	.disqus_click_btn {
            line-height: 30px;
            margin: 0;
            min-width: 50px;
            padding: 0 14px;
            display: inline-block;
            font-family: "Roboto", "Helvetica", "Arial", sans-serif;
            font-size: 14px;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0;
            overflow: hidden;
            will-change: box-shadow;
            transition: box-shadow .2s cubic-bezier(.4, 0, 1, 1), background-color .2s cubic-bezier(.4, 0, .2, 1), color .2s cubic-bezier(.4, 0, .2, 1);
            outline: 0;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
            vertical-align: middle;
            border: 0;
            background: rgba(158, 158, 158, .2);
            box-shadow: 0 2px 2px 0 rgba(0, 0, 0, .14), 0 3px 1px -2px rgba(0, 0, 0, .2), 0 1px 5px 0 rgba(0, 0, 0, .12);
            color: #fff;
            background-color: #7EC0EE;
            text-shadow: 0
        }
</style>
	
<div class="btn_click_load" id="disqus_bt"> 
    <button class="disqus_click_btn">点击查看评论</button>
</div>

<!--
<script type="text/javascript">
$('.btn_click_load').click(function() {
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'Wild-Donkey'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    document.getElementById('disqus_bt').style.display = "none";
});
</script>
-->
<script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'http://wild-donkey.github.io/Contests/SDOI2022/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'http://wild-donkey.github.io/Contests/SDOI2022/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
</script>

<script type="text/javascript">
    $('.btn_click_load').click(function() {  //click to load comments
        (function() { // DON'T EDIT BELOW THIS LINE
            var d = document;
            var s = d.createElement('script');
            s.src = '//Wild-Donkey.disqus.com/embed.js';
            s.setAttribute('data-timestamp', + new Date());
            (d.head || d.body).appendChild(s);
        })();
        $('.btn_click_load').css('display','none');
    });
</script>
</div>
<style>
    #disqus-comment{
        background-color: #eee;
        padding: 2pc;
    }
</style>


                      </div>
                      <!-- Copyright 版权 start -->
                              <div id="copyright">
            <ul>
                <li>&copy;Powered By <a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/" style="border-bottom: none;">hexo</a></li>
                <li>Design: <a target="_blank" rel="noopener" href="http://miccall.tech " style="border-bottom: none;">miccall</a></li>
            </ul>
            
                <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
			
        </div>
                </div>
              </body>


              
 	
</html>
