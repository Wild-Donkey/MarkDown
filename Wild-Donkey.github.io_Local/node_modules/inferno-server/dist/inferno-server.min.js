!function(e,t){"object"===typeof exports&&"undefined"!==typeof module?t(exports,require("inferno"),require("stream")):"function"===typeof define&&define.amd?define(["exports","inferno","stream"],t):t(((e="undefined"!==typeof globalThis?globalThis:e||self).Inferno=e.Inferno||{},e.Inferno.Server=e.Inferno.Server||{}),e.Inferno,e.stream)}(this,(function(e,t,r){"use strict";var n=Array.isArray;function o(e){return void 0===e||null===e}function u(e){return null===e||!1===e||!0===e||void 0===e}function i(e){return"function"===typeof e}function s(e){return"string"===typeof e}function a(e){return"number"===typeof e}function l(e){return null===e}function c(e){throw e||(e="a runtime error occured! Use Inferno in development environment to find the error."),new Error("Inferno Error: "+e)}function d(e,t){var r={};if(e)for(var n in e)r[n]=e[n];if(t)for(var o in t)r[o]=t[o];return r}function f(e){if(s(e))return e;var t,r="";for(var n in e){var o=e[n];("string"===(t=typeof o)||"number"===t)&&(r+=n+":"+o+";")}return r}var h=new RegExp(/["'&<>]/);function p(e){if(!h.test(e))return e;var t,r="",n="",o=0;for(t=0;t<e.length;++t){switch(e.charCodeAt(t)){case 34:n="&quot;";break;case 39:n="&#039;";break;case 38:n="&amp;";break;case 60:n="&lt;";break;case 62:n="&gt;";break;default:continue}t>o&&(r+=e.slice(o,t)),r+=n,o=t+1}return r+e.slice(o,t)}var v=new RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),m={},g={};function y(e){if(void 0!==g[e])return!0;if(void 0!==m[e])return!1;if(v.test(e))return g[e]=!0,!0;return m[e]=!0,!1}var F=new Set(["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]);function T(e,t,r){if(e.constructor.getDerivedStateFromProps)return d(r,e.constructor.getDerivedStateFromProps(t,r));return r}function x(e,r){var n=e.props||t.EMPTY_OBJ;return 32768&e.flags?e.type.render(n,e.ref,r):e.type(n,r)}function Q(e,r,h){var v=e.flags,m=e.type,g=e.props||t.EMPTY_OBJ,b=e.children;if(0!==(14&v)){if(4&v){var S,k=new m(g,h),C=Boolean(m.getDerivedStateFromProps);if(k.$BS=!1,k.$SSR=!0,i(k.getChildContext)&&(S=k.getChildContext()),S=o(S)?h:d(h,S),k.props===t.EMPTY_OBJ&&(k.props=g),k.context=h,!C&&i(k.componentWillMount)){k.$BR=!0,k.componentWillMount(),k.$BR=!1;var P=k.$PS;if(P){var _=k.state;if(null===_)k.state=P;else for(var N in P)_[N]=P[N];k.$PSS=!1,k.$PS=null}}C&&(k.state=T(k,g,k.state));var D=k.render(g,k.state,k.context);if(u(D))return"\x3c!--!--\x3e";if(s(D))return p(D);if(a(D))return D+"";return Q(D,e,S)}var w=x(e,h);if(u(w))return"\x3c!--!--\x3e";if(s(w))return p(w);if(a(w))return w+"";return Q(w,e,h)}if(0!==(481&v)){var M,B="<"+m,$=F.has(m),R=e.className;if(s(R)?B+=' class="'+p(R)+'"':a(R)&&(B+=' class="'+R+'"'),!l(g)){for(var E in g){var I=g[E];switch(E){case"dangerouslySetInnerHTML":M=I.__html;break;case"style":o(g.style)||(B+=' style="'+f(g.style)+'"');break;case"children":case"className":break;case"defaultValue":g.value||(B+=' value="'+(s(I)?p(I):I)+'"');break;case"defaultChecked":g.checked||(B+=' checked="'+I+'"');break;default:y(E)&&(s(I)?B+=" "+E+'="'+p(I)+'"':a(I)?B+=" "+E+'="'+I+'"':!0===I&&(B+=" "+E))}}"option"===m&&"undefined"!==typeof g.value&&g.value===r.props.value&&(B+=" selected")}if($)B+=">";else{B+=">";var A=e.childFlags;if(2===A)B+=Q(b,e,h);else if(12&A)for(var V=0,O=b.length;V<O;++V)B+=Q(b[V],e,h);else 16===A?B+=""===b?" ":p(b):M&&(B+=M);$||(B+="</"+m+">")}if(String(m).match(/[\s\n\/='"\0<>]/))throw B;return B}if(0!==(16&v))return""===b?" ":p(b);if(n(e)||0!==(8192&v)){var j=e.childFlags;if(2===j||n(e)&&0===e.length)return"\x3c!--!--\x3e";if(12&j||n(e)){for(var W=n(e)?e:b,J="",Y=0,q=W.length;Y<q;++Y)J+=Q(W[Y],e,h);return J}}else c();return""}function b(e){return Q(e,{},{})}function S(e){var t=e.$PS;if(t){var r=e.state;if(null===r)e.state=t;else for(var n in t)r[n]=t[n];e.$PS=null}e.$BR=!1}var k=function(e){function r(t){e.call(this),this.collector=[1/0],this.promises=[],this.pushQueue=this.pushQueue.bind(this),t&&this.renderVNodeToQueue(t,null,null)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype._read=function(){setTimeout(this.pushQueue,0)},r.prototype.addToQueue=function(e,t){if(o(t))"string"===typeof e&&this.collector.length-1===0?this.push(e):"string"===typeof e&&"string"===typeof this.collector[this.collector.length-2]?this.collector[this.collector.length-2]+=e:this.collector.splice(-1,0,e);else{var r=this.promises[t].length-1;"string"===typeof this.promises[t][r]&&"string"===typeof e?this.promises[t][r]+=e:this.promises[t].push(e)}},r.prototype.pushQueue=function(){var e=this.collector[0];if("string"===typeof e)this.push(e),this.collector.shift();else if(e&&("object"===typeof e||i(e))&&i(e.then)){var t=this;e.then((function(e){var r;(r=t.collector).splice.apply(r,[0,1].concat(t.promises[e])),t.promises[e]=null,setTimeout(t.pushQueue,0)})),this.collector[0]=null}else e===1/0&&this.emit("end")},r.prototype.renderVNodeToQueue=function(e,r,h){var v=this,m=e.flags,g=e.type,Q=e.props||t.EMPTY_OBJ,b=e.children;if((14&m)>0)if(4&m){var k,C=new g(Q,r),P=Boolean(g.getDerivedStateFromProps);if(C.$BS=!1,C.$SSR=!0,void 0!==C.getChildContext&&(k=C.getChildContext()),o(k)||(r=d(r,k)),C.props===t.EMPTY_OBJ&&(C.props=Q),C.context=r,!P&&i(C.componentWillMount)&&(C.$BR=!0,C.componentWillMount(),S(C)),i(C.getInitialProps)){var _=C.getInitialProps(C.props,C.context);if(_){if(Promise.resolve(_)===_){var N=this.promises.push([])-1;return void this.addToQueue(_.then((function(e){"object"===typeof e&&(C.props=d(C.props,e));var t=C.render(C.props,C.state,C.context);return u(t)?v.addToQueue("\x3c!--!--\x3e",N):s(t)?v.addToQueue(p(t),N):a(t)?v.addToQueue(t+"",N):v.renderVNodeToQueue(t,C.context,N),setTimeout(v.pushQueue,0),N})),h)}C.props=d(C.props,_)}}P&&(C.state=T(C,Q,C.state));var D=C.render(C.props,C.state,C.context);u(D)?this.addToQueue("\x3c!--!--\x3e",h):s(D)?this.addToQueue(p(D),h):a(D)?this.addToQueue(D+"",h):this.renderVNodeToQueue(D,r,h)}else{var w=x(e,r);u(w)?this.addToQueue("\x3c!--!--\x3e",h):s(w)?this.addToQueue(p(w),h):a(w)?this.addToQueue(w+"",h):this.renderVNodeToQueue(w,r,h)}else if((481&m)>0){var M,B="<"+g,$=F.has(g),R=e.className;if(s(R)?B+=' class="'+p(R)+'"':a(R)&&(B+=' class="'+R+'"'),!l(Q))for(var E in Q){var I=Q[E];switch(E){case"dangerouslySetInnerHTML":M=I.__html;break;case"style":o(Q.style)||(B+=' style="'+f(Q.style)+'"');break;case"children":case"className":break;case"defaultValue":Q.value||(B+=' value="'+(s(I)?p(I):I)+'"');break;case"defaultChecked":Q.checked||(B+=' checked="'+I+'"');break;default:y(E)&&(s(I)?B+=" "+E+'="'+p(I)+'"':a(I)?B+=" "+E+'="'+I+'"':!0===I&&(B+=" "+E))}}if(B+=">",String(g).match(/[\s\n\/='"\0<>]/))throw B;if($)this.addToQueue(B,h);else{var A=e.childFlags;if(2===A)return this.addToQueue(B,h),this.renderVNodeToQueue(b,r,h),void this.addToQueue("</"+g+">",h);if(16===A)return this.addToQueue(B,h),this.addToQueue(""===b?" ":p(b+""),h),void this.addToQueue("</"+g+">",h);if(12&A){this.addToQueue(B,h);for(var V=0,O=b.length;V<O;++V)this.renderVNodeToQueue(b[V],r,h);return void this.addToQueue("</"+g+">",h)}if(M)return void this.addToQueue(B+M+"</"+g+">",h);$||this.addToQueue(B+"</"+g+">",h)}}else if((16&m)>0)this.addToQueue(""===b?" ":p(b),h);else if(n(e)||0!==(8192&m)){var j=e.childFlags;if(2===j||n(e)&&0===e.length)this.addToQueue("\x3c!--!--\x3e",h);else if(12&j||n(e)){for(var W=n(e)?e:e.children,J=0,Y=W.length;J<Y;++J)this.renderVNodeToQueue(W[J],r,h);return}}else c()},r}(r.Readable);function C(e){return new k(e)}var P=Promise.resolve(),_=function(e){function t(t){e.call(this),this.started=!1,this.initNode=t}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._read=function(){var e=this;if(this.started)return;this.started=!0,P.then((function(){return e.renderNode(e.initNode,null)})).then((function(){e.push(null)})).catch((function(t){e.emit("error",t)}))},t.prototype.renderNode=function(e,t){var r=e.flags;if((14&r)>0)return this.renderComponent(e,t,4&r);if((481&r)>0)return this.renderElement(e,t);if(n(e)||0!==(8192&r))return this.renderArrayOrFragment(e,t);return this.renderText(e)},t.prototype.renderArrayOrFragment=function(e,t){var r=this,o=e.childFlags;if(2===o||n(e)&&0===e.length)return this.push("\x3c!--!--\x3e");if(12&o||n(e))return(n(e)?e:e.children).reduce((function(e,n){return e.then((function(){return Promise.resolve(r.renderNode(n,t)).then((function(){return!!(16&n.flags)}))}))}),Promise.resolve(!1))},t.prototype.renderComponent=function(e,t,r){var n=this,l=e.type,c=e.props;if(!r){var f=x(e,t);if(u(f))return this.push("\x3c!--!--\x3e");if(s(f))return this.push(p(f));if(a(f))return this.push(f+"");return this.renderNode(f,t)}var h,v=new l(c,t),m=Boolean(l.getDerivedStateFromProps);return v.$BS=!1,v.$SSR=!0,i(v.getChildContext)&&(h=v.getChildContext()),o(h)||(t=d(t,h)),v.context=t,v.$BR=!0,Promise.resolve(!m&&v.componentWillMount&&v.componentWillMount()).then((function(){S(v),m&&(v.state=T(v,c,v.state));var e=v.render(v.props,v.state,v.context);if(u(e))return n.push("\x3c!--!--\x3e");if(s(e))return n.push(p(e));if(a(e))return n.push(e+"");return n.renderNode(e,t)}))},t.prototype.renderChildren=function(e,t,r){var n=this;if(2===r)return this.renderNode(e,t);if(16===r)return this.push(""===e?" ":p(e+""));if(12&r)return e.reduce((function(e,r){return e.then((function(){return Promise.resolve(n.renderNode(r,t)).then((function(){return!!(16&r.flags)}))}))}),Promise.resolve(!1))},t.prototype.renderText=function(e){this.push(""===e.children?" ":p(e.children))},t.prototype.renderElement=function(e,t){var r,n=this,u=e.type,i=e.props,c="<"+u,d=F.has(u),h=e.className;if(s(h)?c+=' class="'+p(h)+'"':a(h)&&(c+=' class="'+h+'"'),!l(i))for(var v in i){var m=i[v];switch(v){case"dangerouslySetInnerHTML":r=m.__html;break;case"style":o(i.style)||(c+=' style="'+f(i.style)+'"');break;case"children":case"className":break;case"defaultValue":i.value||(c+=' value="'+(s(m)?p(m):m)+'"');break;case"defaultChecked":i.checked||(c+=' checked="'+m+'"');break;default:if(y(v)){s(m)?c+=" "+v+'="'+p(m)+'"':a(m)?c+=" "+v+'="'+m+'"':!0===m&&(c+=" "+v);break}}}if(c+=">",this.push(c),String(u).match(/[\s\n\/='"\0<>]/))throw c;if(d)return;if(r)return this.push(r),void this.push("</"+u+">");var g=e.childFlags;if(1===g)return void this.push("</"+u+">");return Promise.resolve(this.renderChildren(e.children,t,g)).then((function(){n.push("</"+u+">")}))},t}(r.Readable);function N(e){return new _(e)}e.RenderQueueStream=k,e.RenderStream=_,e.renderToStaticMarkup=b,e.renderToString=b,e.streamAsStaticMarkup=N,e.streamAsString=N,e.streamQueueAsStaticMarkup=C,e.streamQueueAsString=C,Object.defineProperty(e,"__esModule",{value:!0})}));
